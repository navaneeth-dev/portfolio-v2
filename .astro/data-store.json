[["Map",1,2,9,10],"meta::meta",["Map",3,4,5,6,7,8],"astro-version","5.7.14","content-config-digest","1f207e0f778736ca","astro-config-digest","{\"root\":{},\"srcDir\":{},\"publicDir\":{},\"outDir\":{},\"cacheDir\":{},\"site\":\"https://rizexor.com\",\"compressHTML\":true,\"base\":\"/\",\"trailingSlash\":\"ignore\",\"output\":\"static\",\"scopedStyleStrategy\":\"attribute\",\"build\":{\"format\":\"directory\",\"client\":{},\"server\":{},\"assets\":\"_astro\",\"serverEntry\":\"entry.mjs\",\"redirects\":true,\"inlineStylesheets\":\"auto\",\"concurrency\":1},\"server\":{\"open\":false,\"host\":false,\"port\":4321,\"streaming\":true,\"allowedHosts\":[]},\"redirects\":{},\"image\":{\"endpoint\":{\"route\":\"/_image\"},\"service\":{\"entrypoint\":\"astro/assets/services/sharp\",\"config\":{}},\"domains\":[],\"remotePatterns\":[]},\"devToolbar\":{\"enabled\":true},\"markdown\":{\"syntaxHighlight\":\"shiki\",\"shikiConfig\":{\"langs\":[],\"langAlias\":{},\"theme\":\"catppuccin-mocha\",\"themes\":{},\"wrap\":false,\"transformers\":[]},\"remarkPlugins\":[],\"rehypePlugins\":[null,[null,{\"behavior\":\"append\",\"properties\":{\"class\":\"autolink-header\",\"ariaHidden\":true,\"tabIndex\":-1},\"content\":[{\"type\":\"element\",\"tagName\":\"span\",\"properties\":{\"className\":[\"sr-only\"]},\"children\":[{\"type\":\"text\",\"value\":\" permalink\"}]},{\"type\":\"element\",\"tagName\":\"svg\",\"properties\":{\"className\":[\"inline\",\"ml-2\",\"hover:text-neutral-500\"],\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"fill\":\"currentColor\",\"viewBox\":\"0 0 24 24\"},\"children\":[{\"type\":\"element\",\"tagName\":\"path\",\"properties\":{\"d\":\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\"},\"children\":[]}]}]}]],\"remarkRehype\":{},\"gfm\":true,\"smartypants\":true},\"security\":{\"checkOrigin\":true},\"env\":{\"schema\":{},\"validateSecrets\":false},\"experimental\":{\"clientPrerender\":false,\"contentIntellisense\":false,\"responsiveImages\":false,\"headingIdCompat\":false,\"preserveScriptOrder\":false},\"legacy\":{\"collections\":false}}","blog",["Map",11,12,37,38,136,137,228,229],"why-ansible-sucks",{"id":11,"data":13,"body":23,"filePath":24,"digest":25,"rendered":26,"legacyId":36},{"title":14,"description":15,"pubDate":16,"image":17,"tags":18,"isDraft":21,"author":22},"Why Ansible Sucks","Hello",["Date","2025-06-13T18:30:00.000Z"],"/kubernetes-cluster.jpg",[19,20],"devops","ansible",true,"Navaneeth","not declarative\nslow for high german servers\ndoesn't cleanup","src/content/blog/why-ansible-sucks.md","e3176df202910bef",{"html":27,"metadata":28},"\u003Cp>not declarative\nslow for high german servers\ndoesn’t cleanup\u003C/p>",{"headings":29,"localImagePaths":30,"remoteImagePaths":31,"frontmatter":32,"imagePaths":35},[],[],[],{"title":14,"tags":33,"pubDate":34,"image":17,"description":15,"isDraft":21,"author":22},[19,20],"Jun 14 2025",[],"why-ansible-sucks.md","free-production-kubernetes-cluster",{"id":37,"data":39,"body":48,"filePath":49,"assetImports":50,"digest":56,"rendered":57,"legacyId":135},{"title":40,"description":41,"pubDate":42,"image":17,"tags":43,"isDraft":47,"author":22},"Free Production Grade Kubernetes Cluster For Life","Run and setup a production-ready Kubernetes cluster for free using Infrastructure as Code. This guide shows you how to leverage Oracle Cloud's Free Tier for a secure, easily updatable K8s setup. Learn to automate everything with one command.",["Date","2025-05-05T18:30:00.000Z"],[19,44,45,46],"kubernetes","oracle","cloud",false,"**Discussion Links**: [r/devops]() | [r/kubernetes]()\n\n## Takeaway\n\n* Learn to run a highly available Kubernetes cluster for free.\n* Learn about Oracle Cloud Infrastructure and its Free Tier.\n* Learn about Infrastructure as Code tools like Terraform and Pulumi.\n* Learn to configure Oracle Bastion with Terraform for secure access to a private Kubernetes Cluster.\n* Learn to set up Talos Linux with Longhorn.\n* Learn to automate everything in one command using [taskfile](https://taskfile.dev).\n\nIn this article, I will show you how to create a free, production-ready, highly available, private Kubernetes cluster in one command using Infrastructure as Code tools.\n\n## Why I chose Oracle Cloud?\n\n* **Best Free Tier Among Cloud Providers:** I will explain why Oracle Cloud Infrastructure (OCI) offers a highly competitive and generous Free Tier compared to other cloud providers.\n* **Cost-Effective Production Services:** Learn how OCI can be a viable option for running production-grade services at low costs, even beyond the Free Tier.\n* **Transferable Cloud Skills:** Discover how gaining experience with OCI provides valuable and transferable skills applicable to other hyperscale cloud providers like AWS, Google Cloud Platform (GCP), and Azure.\n* **Free Access to a Hyperscale Cloud:** Understand how to leverage OCI's Free Tier to gain hands-on experience with a powerful, enterprise-grade cloud environment without incurring significant costs.\n\n## What is a hyperscaler?\n\nIn my opinion, **hyperscalers** are cloud providers offering more than 20 services, featuring robust authentication, comprehensive API access, and strong support for Infrastructure as Code tools like Terraform.\n\nIdeally, hyperscalers should provide a diverse range of compute and storage options. This includes offerings like serverless functions, virtual machines (VMs), and containers, alongside various storage types such as S3-compatible object storage and different disk options like SSD, NVMe, and HDD.\n\nAdditionally, hyperscalers typically offer long-term commitment discounts, making them more cost-effective for sustained usage.\n\nExamples of hyperscalers include AWS, Google Cloud, Azure, OVH Cloud, and Oracle.\n\n## Oracle Free Tier Explained\n\nOracle Cloud Infrastructure (OCI) stands out with one of the most generous free tiers among all cloud providers. It offers two distinct types of free tiers:\n\n* **Always Free:** These resources are free for the entire lifetime of your OCI account.\n* **Free Tier:** These resources are free for a period of 12 months.\n\nFor our purposes, the **Always Free Compute Resources** are particularly important. This includes a 3,000 OCPU hours and 18,000 GB hours of RAM per month for ARM virtual machines (VMs), along with two AMD-based compute VMs of the `VM.Standard.E2.1.Micro` shape.\n\n> **Important Considerations for Region Selection:**\n>\n> When setting up your Oracle Cloud account, choose your regions carefully, as **you cannot add or change them later.** Additionally, your **home region** is where you can provision Always Free resources, so select it wisely.\n\nYou have the flexibility to allocate these resources as you see fit. For instance, in this setup, we're utilizing two VMs with 6GB RAM and 1 VCPU each, and one VM with 6GB RAM and 2VCPUs.\n\nBased on the Oracle Price Calculator, which caps the maximum number of hours per month at 720, this configuration translates to:\n\n- 4 VCPUs x 720 hours/month = **2880 OCPU hours**\n- 24 GB RAM x 720 hours/month = **17280 GB hours**\n\n## Why not OCI Kubernetes Engine (OKE)?\n\nWhile using a cloud provider's managed services is often recommended, I opted for **Talos Linux** over Oracle Kubernetes Engine (OKE) managed nodes for a few key reasons:\n\n* **Seamless Upgrades:** Talos Linux allows for **in-place upgrades** of existing nodes, which means you can update your cluster without deleting and recreating nodes. This simplifies maintenance and reduces downtime.\n* **Optimized Resource Usage:** OKE's managed nodes run Oracle Linux, which consumed **more RAM** than necessary. Talos Linux, being a minimal OS, is much more resource-efficient, freeing up valuable memory for your applications.\n* **Greater Customization:** OKE's managed nodes offer **less flexibility** in terms of node specifications. With Talos Linux, you have more control to customize your node's resources to perfectly match your workload requirements. Like have a single node with more VCPU and keep the rest same.\n\n## Why Talos Linux?\n\n- Truly immutable, hardened by default (i.e, no SSH).\n- Built for Kubernetes; no need to manage OS dependencies.\n- Supports most cloud providers and bare metal workloads.\n- Easy Kubernetes upgrades.\n- Built-In Infrastructure as Code support with Terraform.\n\n## Prerequisites\n\n- Download a Talos Linux image from https://factory.talos.dev/ and upload it to Oracle Cloud Custom Images.\n- Oracle Cloud API Key authentication setup for Terraform. Public & private key should be downloaded on your machine.\n\n## Architecture diagram\n\n![](../../images/OCI%20Architecture%20Diagram%20Toolkit%20v24.2-Page-5.drawio.png)\n\nAll Load Balancers are Layer 4 because Layer 7 Load Balancers are significantly more expensive. Layer 4 Load Balancers, in contrast, are free. Only ports 80 and 443 are publicly exposed to the internet. The source code can be found on my GitHub, linked in the references.\n\n## Setting up Terraform\n\nTerraform is an Infrastructure as Code tool to provision resources that uses the language agnostic HashiCorp Configuration Language. We will use it along with Oracle's and Talos Linux's official Terraform provider.\n\nHere we have setup API key authentication with Oracle Cloud and setup Talos Linux's provider.\n\n```hcl\nterraform {\n  required_providers {\n    talos = {\n      source  = \"siderolabs/talos\"\n      version = \"0.8.1\"\n    }\n    oci = {\n      source  = \"oracle/oci\"\n      version = \"7.4.0\"\n    }\n  }\n}\nprovider \"talos\" {\n}\n// omitted variables\nprovider \"oci\" {\n  region           = var.region\n  tenancy_ocid     = var.tenancy_ocid\n  user_ocid        = var.user_ocid\n  fingerprint      = var.fingerprint\n  private_key_path = var.private_key_path\n}\n```\n\n### Setting up VMs\n\nWe are going to create 3 VMs for a highly available setup using Terraform with a Talos Linux image that we uploaded to OCI. We pass the Talos Linux machine config via user_data.\n\n```hcl\nresource \"oci_core_instance\" \"controlplane\" {\n  count = var.control_plane_count\n\n  availability_domain = data.oci_identity_availability_domain.ad.name\n  compartment_id      = var.compartment_ocid\n  display_name        = \"bom-talos-${count.index + 1}\"\n  shape               = var.instance_shape\n  fault_domain        = \"FAULT-DOMAIN-${count.index + 1}\"\n\n  shape_config {\n    ocpus         = count.index + 1 == var.control_plane_count ? 2 : var.instance_ocpus\n    memory_in_gbs = var.instance_shape_config_memory_in_gbs\n  }\n\n  create_vnic_details {\n    subnet_id        = oci_core_subnet.nodes.id\n    display_name     = \"primaryvnic\"\n    assign_public_ip = false\n    hostname_label   = \"bom-talos-${count.index + 1}\"\n    private_ip       = \"10.0.10.${count.index + 2}\"\n  }\n\n  source_details {\n    source_type = \"image\"\n    source_id   = var.talos_image_ocid\n  }\n\n  metadata = {\n    user_data = base64encode(data.talos_machine_configuration.this.machine_configuration)\n  }\n}\n```\n\n### Talos Linux Terraform\n\nLet's take a look at the Talos Linux configuration, there are a few important resources.\n\n- `talos_machine_secrets`: Used for generating Kubernetes authentication secrets like private keys, etc.\n- `talos_machine_configuration`: Used to generate Talos Machine config to be used while installing.\n- `talos_machine_bootstrap`: Used to bootstrap etcd. Run this **ONLY ONCE** for any node in this cluster.\n- `talos_client_configuration`: Stores client config in Terraform state.\n- `talos_cluster_kubeconfig`: Stores kubeconfig in Terraform state.\n\nThere are two important parts we've set for the machine configuration.\n\nFirst, we've configured the `certSANs` for both the cluster and the machines to include `127.0.0.1`. This allows us to authenticate with the Kubernetes API when we port forward it, as the server only verifies if the connecting IP's subject matches and doesn't pose any security risk.\n\nSecondly, we've set numerous fields to support Longhorn, which were copied directly from its documentation.\n\nAdditionally, we've configured the NTP server to Oracle's highly available NTP server, `169.254.169.254`.\n\nWe are also installing the metrics server as part of this setup.\n\n```hcl\ndata \"talos_machine_configuration\" \"this\" {\n  cluster_name     = var.cluster_name\n  machine_type     = \"controlplane\"\n  cluster_endpoint = \"https://${local.endpoint}:6443\"\n  machine_secrets  = talos_machine_secrets.this.machine_secrets\n\n  config_patches = [\n    yamlencode({\n      machine = {\n        certSANs = [local.endpoint]\n        time = {\n          servers = [\"169.254.169.254\"]\n        }\n        sysctls = {\n          \"vm.nr_hugepages\" = 1024\n        }\n        kernel = {\n          modules = [{ name = \"nvme-tcp\" }, { name = \"vfio_pci\" }]\n        }\n        kubelet = {\n          extraArgs = {\n            \"rotate-server-certificates\" = true\n          }\n          extraMounts = [\n            {\n              destination = \"/var/lib/longhorn\"\n              type        = \"bind\"\n              source      = \"/var/lib/longhorn\"\n              options     = [\"bind\", \"rshared\", \"rw\"]\n            }\n          ]\n        }\n      }\n      cluster = {\n        allowSchedulingOnControlPlanes = true\n        extraManifests = [\n          \"https://raw.githubusercontent.com/alex1989hu/kubelet-serving-cert-approver/main/deploy/standalone-install.yaml\",\n          \"https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml\"\n        ]\n        apiServer = {\n          certSANs = [local.endpoint]\n        }\n      }\n    })\n  ]\n}\n```\n\n### Load Balancers\n\nWe need to create 2 private Load Balancers: Talos, Kubernetes API and one publicly exposed Load Balancer for our Ingress. As I said before we are going to create Layer 4 Load Balancers so we need to have a certificate and open ports on every node.\n\nI am using the `NodePort` of Traefik to forward traffic from the Layer 4 Load Balancer. Here is an example for our private Load Balancer for Talos:\n\n```hcl\nresource \"oci_network_load_balancer_network_load_balancer\" \"talos\" {\n  compartment_id = var.compartment_ocid\n  display_name   = \"talos\"\n  subnet_id      = oci_core_subnet.loadbalancers.id\n  is_private     = true # Make the load balancer private\n\n  assigned_private_ipv4 = \"10.0.60.200\"\n}\n```\n\nOur public Load Balancer for Internet Traffic with IPv6:\n\n```hcl\nresource \"oci_network_load_balancer_network_load_balancer\" \"traefik_nlb\" {\n  compartment_id = var.compartment_ocid\n  display_name   = \"traefik_ingress_nlb\"\n  subnet_id      = oci_core_subnet.public_lbs.id\n  is_private     = false # Make the load balancer private\n  nlb_ip_version = \"IPV4_AND_IPV6\"\n\n  assigned_ipv6 = cidrhost(oci_core_subnet.public_lbs.ipv6cidr_block, 200)\n}\n```\n\nOur setup is now highly available so even if one node fails there is no downtime.\n\n### Security\n\nSecurity is very simple, we only expose the ports we need. All egress traffic is allowed and all traffic inside our private nodes subnet is allowed. Here is an example:\n\n```hcl\nresource \"oci_core_security_list\" \"loadbalancers_sec_list\" {\n  compartment_id = var.compartment_ocid\n  vcn_id         = oci_core_virtual_network.talos_vcn.id\n  display_name   = \"Private Load Balancer security list\"\n\n  # IPv4: Allow all egress traffic\n  egress_security_rules {\n    protocol    = \"all\"\n    destination = \"0.0.0.0/0\"\n  }\n\n  # IPv4: Allow Talos from Bastion\n  ingress_security_rules {\n    protocol = \"6\"\n    source   = \"10.0.30.0/24\"\n\n    tcp_options {\n      max = \"50000\"\n      min = \"50000\"\n    }\n  }\n\n  # IPv4: Allow K8S from Bastion\n  ingress_security_rules {\n    protocol = \"6\"\n    source   = \"10.0.30.0/24\"\n\n    tcp_options {\n      max = \"6443\"\n      min = \"6443\"\n    }\n  }\n}\n```\n\n### Automating SSH Port Forwarding with OCI Bastion\n\nNow comes the important part: to automate port forwarding, I utilized the SSH multiplexing feature. This allowed me to create SSH port forwarding sessions in the background without the command being in the foreground indefinitely and exit them cleanly if needed without shell scripting.\n\nThe `command` is simply quitting any existing session and then creating a new one. This handles cases where a session might exist but the connection is not properly established.\n\nI used `timestamp()` to **ALWAYS** run the port forwarding command to handle cases where the infrastructure is up to date but we need to rerun the port forwarding command. This is the reason we are using `null_resource` so it can re-run independently.\n\nAs an example to port forward the Talos API server:\n\n```hcl\nresource \"null_resource\" \"talos\" {\n  depends_on = [oci_bastion_session.talos_session]\n  triggers = {\n    always_run = \"${timestamp()}\"\n  }\n  provisioner \"local-exec\" {\n    command = \"ssh -S bastion_session_talos -O exit ${local.talos_bastion_user}; ssh -M -S bastion_session_talos -fNL 50000:10.0.60.200:50000 ${local.talos_bastion_user}\"\n  }\n}\n```\n\nNow that our production-ready highly available private Kubernetes cluster is ready we can start installing some stuff.\n\n## Bootstrapping ArgoCD\n\nI used Pulumi to bootstrap ArgoCD because I wanted to convert my existing Terraform code to Pulumi in the future so I can programmatic port forward using a library from a real programming language instead of relying on shell commands.\n\nFirst we just install ArgoCD then we apply our ArgoCD app of apps root application.\n\n```ts\nimport * as k8s from \"@pulumi/kubernetes\";\n\nconst argoCD = new k8s.kustomize.v2.Directory(\"argoCDKustomize\", {\n  directory: \"./bootstrap\",\n});\nconst argoCDRootApp = new k8s.yaml.v2.ConfigFile(\n  \"argocd-root-app\",\n  {\n    file: \"../../root-argocd-app.yaml\",\n  },\n  { dependsOn: [argoCD] }\n);\n```\n\nBootstrap directory just has a kustomization file with a manifest pointing to ArgoCD installation.\n\n```yaml\n# kustomization.yaml\napiVersion: kustomize.config.k8s.io/v1beta1\nkind: Kustomization\n\nnamespace: argocd\nresources:\n- ./ns.yaml\n- https://raw.githubusercontent.com/argoproj/argo-cd/v3.0.2/manifests/install.yaml\n```\n\n```yaml\n# ns.yaml\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: argocd\n```\n\n## Automating everything with one command\n\nTo have one command setup everything: Terraform -> Pulumi -> storing kubeconfig & talosconfig I am using [taskfile](https://taskfile.dev/).\n\n```yaml\ntasks:\n  default:\n    cmds:\n      - terraform apply -auto-approve\n      - task: configs\n    silent: true\n  configs:\n    cmds:\n      - terraform output -raw talosconfig > ./talosconfig\n      - terraform output -raw kubeconfig > ./kubeconfig\n      - mv ./kubeconfig ~/.kube/config\n```\n\n## Resource Usage\n\nThe cluster is just running Traefik, Sealed Secrets, Reflector, Longhorn, kube-prometheus-stack, External Secrets, Cloudnative PG, cert-manager and ArgoCD.\n\nAdditionally there is a single Laravel app deployed with staging and prod environments.\n\nI have attached the screenshots of Node Exporter of each node:\n\n![](../../images/free-production-kubernetes-cluster-usage-1.png)\n\n![](../../images/free-production-kubernetes-cluster-usage-2.png)\n\n![](../../images/free-production-kubernetes-cluster-usage-3.png)\n\n## Upgrading\n\n### Kubernetes & Talos\n\nNot yet tested. Will update the article once I test it.\n\n### Apps & Dependencies\n\nI use [Renovate](https://docs.renovatebot.com/) to keep my dependencies up to date. Nothing more to say, it works really well with Infrastructure as Code tools.\n\n![](../../images/free-production-kubernetes-cluster-renovate.png)\n\n## Future improvements\n\n- Migrate Terraform to Pulumi.\n- Remove dependency of uploading Talos Linux image.\n- Use a library to programmatically port forward using OCI Bastion. \n- Fully automated ArgoCD with sync waves for COMPLETELY automated bootstrap and deployment.\n- Making ArgoCD environment adaptable for other people like easily change domain and it should work.\n\n## References\n\n- [https://github.com/navaneeth-dev/public-gitops/tree/main/infrastructure](https://github.com/navaneeth-dev/public-gitops/tree/main/infrastructure)\n- https://codefresh.io/blog/how-to-structure-your-argo-cd-repositories-using-application-sets/","src/content/blog/free-production-kubernetes-cluster.md",[51,52,53,54,55],"../../images/OCI Architecture Diagram Toolkit v24.2-Page-5.drawio.png","../../images/free-production-kubernetes-cluster-usage-1.png","../../images/free-production-kubernetes-cluster-usage-2.png","../../images/free-production-kubernetes-cluster-usage-3.png","../../images/free-production-kubernetes-cluster-renovate.png","50c147761c09f5dc",{"html":58,"metadata":59},"\u003Cp>\u003Cstrong>Discussion Links\u003C/strong>: \u003Ca href=\"\">r/devops\u003C/a> | \u003Ca href=\"\">r/kubernetes\u003C/a>\u003C/p>\n\u003Ch2 id=\"takeaway\">Takeaway\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#takeaway\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h2>\n\u003Cul>\n\u003Cli>Learn to run a highly available Kubernetes cluster for free.\u003C/li>\n\u003Cli>Learn about Oracle Cloud Infrastructure and its Free Tier.\u003C/li>\n\u003Cli>Learn about Infrastructure as Code tools like Terraform and Pulumi.\u003C/li>\n\u003Cli>Learn to configure Oracle Bastion with Terraform for secure access to a private Kubernetes Cluster.\u003C/li>\n\u003Cli>Learn to set up Talos Linux with Longhorn.\u003C/li>\n\u003Cli>Learn to automate everything in one command using \u003Ca href=\"https://taskfile.dev\">taskfile\u003C/a>.\u003C/li>\n\u003C/ul>\n\u003Cp>In this article, I will show you how to create a free, production-ready, highly available, private Kubernetes cluster in one command using Infrastructure as Code tools.\u003C/p>\n\u003Ch2 id=\"why-i-chose-oracle-cloud\">Why I chose Oracle Cloud?\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#why-i-chose-oracle-cloud\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h2>\n\u003Cul>\n\u003Cli>\u003Cstrong>Best Free Tier Among Cloud Providers:\u003C/strong> I will explain why Oracle Cloud Infrastructure (OCI) offers a highly competitive and generous Free Tier compared to other cloud providers.\u003C/li>\n\u003Cli>\u003Cstrong>Cost-Effective Production Services:\u003C/strong> Learn how OCI can be a viable option for running production-grade services at low costs, even beyond the Free Tier.\u003C/li>\n\u003Cli>\u003Cstrong>Transferable Cloud Skills:\u003C/strong> Discover how gaining experience with OCI provides valuable and transferable skills applicable to other hyperscale cloud providers like AWS, Google Cloud Platform (GCP), and Azure.\u003C/li>\n\u003Cli>\u003Cstrong>Free Access to a Hyperscale Cloud:\u003C/strong> Understand how to leverage OCI’s Free Tier to gain hands-on experience with a powerful, enterprise-grade cloud environment without incurring significant costs.\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"what-is-a-hyperscaler\">What is a hyperscaler?\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#what-is-a-hyperscaler\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h2>\n\u003Cp>In my opinion, \u003Cstrong>hyperscalers\u003C/strong> are cloud providers offering more than 20 services, featuring robust authentication, comprehensive API access, and strong support for Infrastructure as Code tools like Terraform.\u003C/p>\n\u003Cp>Ideally, hyperscalers should provide a diverse range of compute and storage options. This includes offerings like serverless functions, virtual machines (VMs), and containers, alongside various storage types such as S3-compatible object storage and different disk options like SSD, NVMe, and HDD.\u003C/p>\n\u003Cp>Additionally, hyperscalers typically offer long-term commitment discounts, making them more cost-effective for sustained usage.\u003C/p>\n\u003Cp>Examples of hyperscalers include AWS, Google Cloud, Azure, OVH Cloud, and Oracle.\u003C/p>\n\u003Ch2 id=\"oracle-free-tier-explained\">Oracle Free Tier Explained\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#oracle-free-tier-explained\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h2>\n\u003Cp>Oracle Cloud Infrastructure (OCI) stands out with one of the most generous free tiers among all cloud providers. It offers two distinct types of free tiers:\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>Always Free:\u003C/strong> These resources are free for the entire lifetime of your OCI account.\u003C/li>\n\u003Cli>\u003Cstrong>Free Tier:\u003C/strong> These resources are free for a period of 12 months.\u003C/li>\n\u003C/ul>\n\u003Cp>For our purposes, the \u003Cstrong>Always Free Compute Resources\u003C/strong> are particularly important. This includes a 3,000 OCPU hours and 18,000 GB hours of RAM per month for ARM virtual machines (VMs), along with two AMD-based compute VMs of the \u003Ccode>VM.Standard.E2.1.Micro\u003C/code> shape.\u003C/p>\n\u003Cblockquote>\n\u003Cp>\u003Cstrong>Important Considerations for Region Selection:\u003C/strong>\u003C/p>\n\u003Cp>When setting up your Oracle Cloud account, choose your regions carefully, as \u003Cstrong>you cannot add or change them later.\u003C/strong> Additionally, your \u003Cstrong>home region\u003C/strong> is where you can provision Always Free resources, so select it wisely.\u003C/p>\n\u003C/blockquote>\n\u003Cp>You have the flexibility to allocate these resources as you see fit. For instance, in this setup, we’re utilizing two VMs with 6GB RAM and 1 VCPU each, and one VM with 6GB RAM and 2VCPUs.\u003C/p>\n\u003Cp>Based on the Oracle Price Calculator, which caps the maximum number of hours per month at 720, this configuration translates to:\u003C/p>\n\u003Cul>\n\u003Cli>4 VCPUs x 720 hours/month = \u003Cstrong>2880 OCPU hours\u003C/strong>\u003C/li>\n\u003Cli>24 GB RAM x 720 hours/month = \u003Cstrong>17280 GB hours\u003C/strong>\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"why-not-oci-kubernetes-engine-oke\">Why not OCI Kubernetes Engine (OKE)?\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#why-not-oci-kubernetes-engine-oke\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h2>\n\u003Cp>While using a cloud provider’s managed services is often recommended, I opted for \u003Cstrong>Talos Linux\u003C/strong> over Oracle Kubernetes Engine (OKE) managed nodes for a few key reasons:\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>Seamless Upgrades:\u003C/strong> Talos Linux allows for \u003Cstrong>in-place upgrades\u003C/strong> of existing nodes, which means you can update your cluster without deleting and recreating nodes. This simplifies maintenance and reduces downtime.\u003C/li>\n\u003Cli>\u003Cstrong>Optimized Resource Usage:\u003C/strong> OKE’s managed nodes run Oracle Linux, which consumed \u003Cstrong>more RAM\u003C/strong> than necessary. Talos Linux, being a minimal OS, is much more resource-efficient, freeing up valuable memory for your applications.\u003C/li>\n\u003Cli>\u003Cstrong>Greater Customization:\u003C/strong> OKE’s managed nodes offer \u003Cstrong>less flexibility\u003C/strong> in terms of node specifications. With Talos Linux, you have more control to customize your node’s resources to perfectly match your workload requirements. Like have a single node with more VCPU and keep the rest same.\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"why-talos-linux\">Why Talos Linux?\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#why-talos-linux\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h2>\n\u003Cul>\n\u003Cli>Truly immutable, hardened by default (i.e, no SSH).\u003C/li>\n\u003Cli>Built for Kubernetes; no need to manage OS dependencies.\u003C/li>\n\u003Cli>Supports most cloud providers and bare metal workloads.\u003C/li>\n\u003Cli>Easy Kubernetes upgrades.\u003C/li>\n\u003Cli>Built-In Infrastructure as Code support with Terraform.\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"prerequisites\">Prerequisites\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#prerequisites\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h2>\n\u003Cul>\n\u003Cli>Download a Talos Linux image from \u003Ca href=\"https://factory.talos.dev/\">https://factory.talos.dev/\u003C/a> and upload it to Oracle Cloud Custom Images.\u003C/li>\n\u003Cli>Oracle Cloud API Key authentication setup for Terraform. Public &#x26; private key should be downloaded on your machine.\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"architecture-diagram\">Architecture diagram\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#architecture-diagram\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h2>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/OCI Architecture Diagram Toolkit v24.2-Page-5.drawio.png&#x22;,&#x22;alt&#x22;:&#x22;&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Cp>All Load Balancers are Layer 4 because Layer 7 Load Balancers are significantly more expensive. Layer 4 Load Balancers, in contrast, are free. Only ports 80 and 443 are publicly exposed to the internet. The source code can be found on my GitHub, linked in the references.\u003C/p>\n\u003Ch2 id=\"setting-up-terraform\">Setting up Terraform\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#setting-up-terraform\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h2>\n\u003Cp>Terraform is an Infrastructure as Code tool to provision resources that uses the language agnostic HashiCorp Configuration Language. We will use it along with Oracle’s and Talos Linux’s official Terraform provider.\u003C/p>\n\u003Cp>Here we have setup API key authentication with Oracle Cloud and setup Talos Linux’s provider.\u003C/p>\n\u003Cpre class=\"astro-code catppuccin-mocha\" style=\"background-color:#1e1e2e;color:#cdd6f4; overflow-x: auto;\" tabindex=\"0\" data-language=\"hcl\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F9E2AF;font-style:italic\">terraform\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F9E2AF;font-style:italic\">  required_providers\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">    talos \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">      source  \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"siderolabs/talos\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">      version \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"0.8.1\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">    oci \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">      source  \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"oracle/oci\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">      version \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"7.4.0\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F9E2AF;font-style:italic\">provider\u003C/span>\u003Cspan style=\"color:#94E2D5\"> \"talos\"\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2;font-style:italic\">// omitted variables\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F9E2AF;font-style:italic\">provider\u003C/span>\u003Cspan style=\"color:#94E2D5\"> \"oci\"\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  region           \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> var\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">region\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  tenancy_ocid     \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> var\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">tenancy_ocid\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  user_ocid        \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> var\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">user_ocid\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  fingerprint      \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> var\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">fingerprint\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  private_key_path \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> var\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">private_key_path\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"setting-up-vms\">Setting up VMs\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#setting-up-vms\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h3>\n\u003Cp>We are going to create 3 VMs for a highly available setup using Terraform with a Talos Linux image that we uploaded to OCI. We pass the Talos Linux machine config via user_data.\u003C/p>\n\u003Cpre class=\"astro-code catppuccin-mocha\" style=\"background-color:#1e1e2e;color:#cdd6f4; overflow-x: auto;\" tabindex=\"0\" data-language=\"hcl\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F9E2AF;font-style:italic\">resource\u003C/span>\u003Cspan style=\"color:#94E2D5\"> \"oci_core_instance\"\u003C/span>\u003Cspan style=\"color:#94E2D5\"> \"controlplane\"\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  count \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> var\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">control_plane_count\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  availability_domain \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> data\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">oci_identity_availability_domain\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">ad\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">name\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  compartment_id      \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> var\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">compartment_ocid\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  display_name        \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"bom-talos-\u003C/span>\u003Cspan style=\"color:#CBA6F7\">${\u003C/span>\u003Cspan style=\"color:#CDD6F4\">count\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">index\u003C/span>\u003Cspan style=\"color:#94E2D5\"> +\u003C/span>\u003Cspan style=\"color:#FAB387\"> 1\u003C/span>\u003Cspan style=\"color:#CBA6F7\">}\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  shape               \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> var\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">instance_shape\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  fault_domain        \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"FAULT-DOMAIN-\u003C/span>\u003Cspan style=\"color:#CBA6F7\">${\u003C/span>\u003Cspan style=\"color:#CDD6F4\">count\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">index\u003C/span>\u003Cspan style=\"color:#94E2D5\"> +\u003C/span>\u003Cspan style=\"color:#FAB387\"> 1\u003C/span>\u003Cspan style=\"color:#CBA6F7\">}\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F9E2AF;font-style:italic\">  shape_config\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">    ocpus         \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> count\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">index \u003C/span>\u003Cspan style=\"color:#94E2D5\">+\u003C/span>\u003Cspan style=\"color:#FAB387\"> 1\u003C/span>\u003Cspan style=\"color:#94E2D5\"> ==\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> var\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">control_plane_count \u003C/span>\u003Cspan style=\"color:#94E2D5\">?\u003C/span>\u003Cspan style=\"color:#FAB387\"> 2\u003C/span>\u003Cspan style=\"color:#94E2D5\"> :\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> var\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">instance_ocpus\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">    memory_in_gbs \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> var\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">instance_shape_config_memory_in_gbs\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F9E2AF;font-style:italic\">  create_vnic_details\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">    subnet_id        \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> oci_core_subnet\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">nodes\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">id\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">    display_name     \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"primaryvnic\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">    assign_public_ip \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#F38BA8\"> false\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">    hostname_label   \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"bom-talos-\u003C/span>\u003Cspan style=\"color:#CBA6F7\">${\u003C/span>\u003Cspan style=\"color:#CDD6F4\">count\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">index\u003C/span>\u003Cspan style=\"color:#94E2D5\"> +\u003C/span>\u003Cspan style=\"color:#FAB387\"> 1\u003C/span>\u003Cspan style=\"color:#CBA6F7\">}\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">    private_ip       \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"10.0.10.\u003C/span>\u003Cspan style=\"color:#CBA6F7\">${\u003C/span>\u003Cspan style=\"color:#CDD6F4\">count\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">index\u003C/span>\u003Cspan style=\"color:#94E2D5\"> +\u003C/span>\u003Cspan style=\"color:#FAB387\"> 2\u003C/span>\u003Cspan style=\"color:#CBA6F7\">}\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F9E2AF;font-style:italic\">  source_details\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">    source_type \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"image\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">    source_id   \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> var\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">talos_image_ocid\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  metadata \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">    user_data \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#F38BA8;font-style:italic\"> base64encode\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#CDD6F4\">data\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">talos_machine_configuration\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">this\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">machine_configuration\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"talos-linux-terraform\">Talos Linux Terraform\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#talos-linux-terraform\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h3>\n\u003Cp>Let’s take a look at the Talos Linux configuration, there are a few important resources.\u003C/p>\n\u003Cul>\n\u003Cli>\u003Ccode>talos_machine_secrets\u003C/code>: Used for generating Kubernetes authentication secrets like private keys, etc.\u003C/li>\n\u003Cli>\u003Ccode>talos_machine_configuration\u003C/code>: Used to generate Talos Machine config to be used while installing.\u003C/li>\n\u003Cli>\u003Ccode>talos_machine_bootstrap\u003C/code>: Used to bootstrap etcd. Run this \u003Cstrong>ONLY ONCE\u003C/strong> for any node in this cluster.\u003C/li>\n\u003Cli>\u003Ccode>talos_client_configuration\u003C/code>: Stores client config in Terraform state.\u003C/li>\n\u003Cli>\u003Ccode>talos_cluster_kubeconfig\u003C/code>: Stores kubeconfig in Terraform state.\u003C/li>\n\u003C/ul>\n\u003Cp>There are two important parts we’ve set for the machine configuration.\u003C/p>\n\u003Cp>First, we’ve configured the \u003Ccode>certSANs\u003C/code> for both the cluster and the machines to include \u003Ccode>127.0.0.1\u003C/code>. This allows us to authenticate with the Kubernetes API when we port forward it, as the server only verifies if the connecting IP’s subject matches and doesn’t pose any security risk.\u003C/p>\n\u003Cp>Secondly, we’ve set numerous fields to support Longhorn, which were copied directly from its documentation.\u003C/p>\n\u003Cp>Additionally, we’ve configured the NTP server to Oracle’s highly available NTP server, \u003Ccode>169.254.169.254\u003C/code>.\u003C/p>\n\u003Cp>We are also installing the metrics server as part of this setup.\u003C/p>\n\u003Cpre class=\"astro-code catppuccin-mocha\" style=\"background-color:#1e1e2e;color:#cdd6f4; overflow-x: auto;\" tabindex=\"0\" data-language=\"hcl\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F9E2AF;font-style:italic\">data\u003C/span>\u003Cspan style=\"color:#94E2D5\"> \"talos_machine_configuration\"\u003C/span>\u003Cspan style=\"color:#94E2D5\"> \"this\"\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  cluster_name     \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> var\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">cluster_name\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  machine_type     \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"controlplane\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  cluster_endpoint \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"https://\u003C/span>\u003Cspan style=\"color:#CBA6F7\">${\u003C/span>\u003Cspan style=\"color:#CDD6F4\">local\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">endpoint\u003C/span>\u003Cspan style=\"color:#CBA6F7\">}\u003C/span>\u003Cspan style=\"color:#A6E3A1\">:6443\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  machine_secrets  \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> talos_machine_secrets\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">this\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">machine_secrets\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  config_patches \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#9399B2\"> [\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F38BA8;font-style:italic\">    yamlencode\u003C/span>\u003Cspan style=\"color:#9399B2\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">      machine \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">        certSANs \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> [local.endpoint]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">        time \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">          servers \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> [\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"169.254.169.254\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">        sysctls \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#A6E3A1\">          \"vm.nr_hugepages\"\u003C/span>\u003Cspan style=\"color:#94E2D5\"> =\u003C/span>\u003Cspan style=\"color:#FAB387\"> 1024\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">        kernel \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">          modules \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> [\u003C/span>\u003Cspan style=\"color:#9399B2\">{\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> name \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"nvme-tcp\"\u003C/span>\u003Cspan style=\"color:#9399B2\"> }\u003C/span>\u003Cspan style=\"color:#CDD6F4\">, \u003C/span>\u003Cspan style=\"color:#9399B2\">{\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> name \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"vfio_pci\"\u003C/span>\u003Cspan style=\"color:#9399B2\"> }\u003C/span>\u003Cspan style=\"color:#CDD6F4\">]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">        kubelet \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">          extraArgs \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#A6E3A1\">            \"rotate-server-certificates\"\u003C/span>\u003Cspan style=\"color:#94E2D5\"> =\u003C/span>\u003Cspan style=\"color:#F38BA8\"> true\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">          }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">          extraMounts \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> [\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">            {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">              destination \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"/var/lib/longhorn\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">              type        \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"bind\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">              source      \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"/var/lib/longhorn\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">              options     \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> [\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"bind\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">, \u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"rshared\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">, \u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"rw\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">            }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">          ]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">      }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">      cluster \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">        allowSchedulingOnControlPlanes \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#F38BA8\"> true\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">        extraManifests \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> [\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#A6E3A1\">          \"https://raw.githubusercontent.com/alex1989hu/kubelet-serving-cert-approver/main/deploy/standalone-install.yaml\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#A6E3A1\">          \"https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">        ]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">        apiServer \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">          certSANs \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> [local.endpoint]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">      }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">    })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">  ]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"load-balancers\">Load Balancers\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#load-balancers\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h3>\n\u003Cp>We need to create 2 private Load Balancers: Talos, Kubernetes API and one publicly exposed Load Balancer for our Ingress. As I said before we are going to create Layer 4 Load Balancers so we need to have a certificate and open ports on every node.\u003C/p>\n\u003Cp>I am using the \u003Ccode>NodePort\u003C/code> of Traefik to forward traffic from the Layer 4 Load Balancer. Here is an example for our private Load Balancer for Talos:\u003C/p>\n\u003Cpre class=\"astro-code catppuccin-mocha\" style=\"background-color:#1e1e2e;color:#cdd6f4; overflow-x: auto;\" tabindex=\"0\" data-language=\"hcl\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F9E2AF;font-style:italic\">resource\u003C/span>\u003Cspan style=\"color:#94E2D5\"> \"oci_network_load_balancer_network_load_balancer\"\u003C/span>\u003Cspan style=\"color:#94E2D5\"> \"talos\"\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  compartment_id \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> var\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">compartment_ocid\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  display_name   \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"talos\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  subnet_id      \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> oci_core_subnet\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">loadbalancers\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">id\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  is_private     \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#F38BA8\"> true\u003C/span>\u003Cspan style=\"color:#9399B2;font-style:italic\"> # Make the load balancer private\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  assigned_private_ipv4 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"10.0.60.200\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Our public Load Balancer for Internet Traffic with IPv6:\u003C/p>\n\u003Cpre class=\"astro-code catppuccin-mocha\" style=\"background-color:#1e1e2e;color:#cdd6f4; overflow-x: auto;\" tabindex=\"0\" data-language=\"hcl\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F9E2AF;font-style:italic\">resource\u003C/span>\u003Cspan style=\"color:#94E2D5\"> \"oci_network_load_balancer_network_load_balancer\"\u003C/span>\u003Cspan style=\"color:#94E2D5\"> \"traefik_nlb\"\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  compartment_id \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> var\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">compartment_ocid\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  display_name   \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"traefik_ingress_nlb\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  subnet_id      \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> oci_core_subnet\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">public_lbs\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">id\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  is_private     \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#F38BA8\"> false\u003C/span>\u003Cspan style=\"color:#9399B2;font-style:italic\"> # Make the load balancer private\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  nlb_ip_version \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"IPV4_AND_IPV6\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  assigned_ipv6 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#F38BA8;font-style:italic\"> cidrhost\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#CDD6F4\">oci_core_subnet\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">public_lbs\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">ipv6cidr_block\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#FAB387\"> 200\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Our setup is now highly available so even if one node fails there is no downtime.\u003C/p>\n\u003Ch3 id=\"security\">Security\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#security\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h3>\n\u003Cp>Security is very simple, we only expose the ports we need. All egress traffic is allowed and all traffic inside our private nodes subnet is allowed. Here is an example:\u003C/p>\n\u003Cpre class=\"astro-code catppuccin-mocha\" style=\"background-color:#1e1e2e;color:#cdd6f4; overflow-x: auto;\" tabindex=\"0\" data-language=\"hcl\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F9E2AF;font-style:italic\">resource\u003C/span>\u003Cspan style=\"color:#94E2D5\"> \"oci_core_security_list\"\u003C/span>\u003Cspan style=\"color:#94E2D5\"> \"loadbalancers_sec_list\"\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  compartment_id \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> var\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">compartment_ocid\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  vcn_id         \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> oci_core_virtual_network\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">talos_vcn\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">id\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  display_name   \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"Private Load Balancer security list\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2;font-style:italic\">  # IPv4: Allow all egress traffic\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F9E2AF;font-style:italic\">  egress_security_rules\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">    protocol    \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"all\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">    destination \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"0.0.0.0/0\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2;font-style:italic\">  # IPv4: Allow Talos from Bastion\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F9E2AF;font-style:italic\">  ingress_security_rules\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">    protocol \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"6\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">    source   \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"10.0.30.0/24\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F9E2AF;font-style:italic\">    tcp_options\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">      max \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"50000\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">      min \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"50000\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2;font-style:italic\">  # IPv4: Allow K8S from Bastion\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F9E2AF;font-style:italic\">  ingress_security_rules\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">    protocol \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"6\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">    source   \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"10.0.30.0/24\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F9E2AF;font-style:italic\">    tcp_options\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">      max \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"6443\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">      min \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"6443\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"automating-ssh-port-forwarding-with-oci-bastion\">Automating SSH Port Forwarding with OCI Bastion\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#automating-ssh-port-forwarding-with-oci-bastion\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h3>\n\u003Cp>Now comes the important part: to automate port forwarding, I utilized the SSH multiplexing feature. This allowed me to create SSH port forwarding sessions in the background without the command being in the foreground indefinitely and exit them cleanly if needed without shell scripting.\u003C/p>\n\u003Cp>The \u003Ccode>command\u003C/code> is simply quitting any existing session and then creating a new one. This handles cases where a session might exist but the connection is not properly established.\u003C/p>\n\u003Cp>I used \u003Ccode>timestamp()\u003C/code> to \u003Cstrong>ALWAYS\u003C/strong> run the port forwarding command to handle cases where the infrastructure is up to date but we need to rerun the port forwarding command. This is the reason we are using \u003Ccode>null_resource\u003C/code> so it can re-run independently.\u003C/p>\n\u003Cp>As an example to port forward the Talos API server:\u003C/p>\n\u003Cpre class=\"astro-code catppuccin-mocha\" style=\"background-color:#1e1e2e;color:#cdd6f4; overflow-x: auto;\" tabindex=\"0\" data-language=\"hcl\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F9E2AF;font-style:italic\">resource\u003C/span>\u003Cspan style=\"color:#94E2D5\"> \"null_resource\"\u003C/span>\u003Cspan style=\"color:#94E2D5\"> \"talos\"\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  depends_on \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#9399B2\"> [\u003C/span>\u003Cspan style=\"color:#CDD6F4\">oci_bastion_session\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">talos_session\u003C/span>\u003Cspan style=\"color:#9399B2\">]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  triggers \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">    always_run \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"\u003C/span>\u003Cspan style=\"color:#CBA6F7\">${\u003C/span>\u003Cspan style=\"color:#F38BA8;font-style:italic\">timestamp\u003C/span>\u003Cspan style=\"color:#9399B2\">()\u003C/span>\u003Cspan style=\"color:#CBA6F7\">}\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F9E2AF;font-style:italic\">  provisioner\u003C/span>\u003Cspan style=\"color:#94E2D5\"> \"local-exec\"\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">    command \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"ssh -S bastion_session_talos -O exit \u003C/span>\u003Cspan style=\"color:#CBA6F7\">${\u003C/span>\u003Cspan style=\"color:#CDD6F4\">local\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">talos_bastion_user\u003C/span>\u003Cspan style=\"color:#CBA6F7\">}\u003C/span>\u003Cspan style=\"color:#A6E3A1\">; ssh -M -S bastion_session_talos -fNL 50000:10.0.60.200:50000 \u003C/span>\u003Cspan style=\"color:#CBA6F7\">${\u003C/span>\u003Cspan style=\"color:#CDD6F4\">local\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">talos_bastion_user\u003C/span>\u003Cspan style=\"color:#CBA6F7\">}\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Now that our production-ready highly available private Kubernetes cluster is ready we can start installing some stuff.\u003C/p>\n\u003Ch2 id=\"bootstrapping-argocd\">Bootstrapping ArgoCD\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#bootstrapping-argocd\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h2>\n\u003Cp>I used Pulumi to bootstrap ArgoCD because I wanted to convert my existing Terraform code to Pulumi in the future so I can programmatic port forward using a library from a real programming language instead of relying on shell commands.\u003C/p>\n\u003Cp>First we just install ArgoCD then we apply our ArgoCD app of apps root application.\u003C/p>\n\u003Cpre class=\"astro-code catppuccin-mocha\" style=\"background-color:#1e1e2e;color:#cdd6f4; overflow-x: auto;\" tabindex=\"0\" data-language=\"ts\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">import\u003C/span>\u003Cspan style=\"color:#F38BA8\"> *\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> as\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> k8s \u003C/span>\u003Cspan style=\"color:#CBA6F7\">from\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"@pulumi/kubernetes\"\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">const\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> argoCD \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CBA6F7;font-weight:bold\"> new\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> k8s\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">kustomize\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">v2\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">Directory\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"argoCDKustomize\"\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  directory\u003C/span>\u003Cspan style=\"color:#94E2D5\">:\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"./bootstrap\"\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">}\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">const\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> argoCDRootApp \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CBA6F7;font-weight:bold\"> new\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> k8s\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">yaml\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">v2\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">ConfigFile\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#A6E3A1\">  \"argocd-root-app\"\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">  {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">    file\u003C/span>\u003Cspan style=\"color:#94E2D5\">:\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"../../root-argocd-app.yaml\"\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">  {\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> dependsOn\u003C/span>\u003Cspan style=\"color:#94E2D5\">:\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> [argoCD] \u003C/span>\u003Cspan style=\"color:#9399B2\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Bootstrap directory just has a kustomization file with a manifest pointing to ArgoCD installation.\u003C/p>\n\u003Cpre class=\"astro-code catppuccin-mocha\" style=\"background-color:#1e1e2e;color:#cdd6f4; overflow-x: auto;\" tabindex=\"0\" data-language=\"yaml\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2;font-style:italic\"># kustomization.yaml\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA\">apiVersion\u003C/span>\u003Cspan style=\"color:#94E2D5\">:\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> kustomize.config.k8s.io/v1beta1\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA\">kind\u003C/span>\u003Cspan style=\"color:#94E2D5\">:\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> Kustomization\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA\">namespace\u003C/span>\u003Cspan style=\"color:#94E2D5\">:\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> argocd\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA\">resources\u003C/span>\u003Cspan style=\"color:#94E2D5\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">-\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> ./ns.yaml\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">-\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> https://raw.githubusercontent.com/argoproj/argo-cd/v3.0.2/manifests/install.yaml\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cpre class=\"astro-code catppuccin-mocha\" style=\"background-color:#1e1e2e;color:#cdd6f4; overflow-x: auto;\" tabindex=\"0\" data-language=\"yaml\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2;font-style:italic\"># ns.yaml\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA\">apiVersion\u003C/span>\u003Cspan style=\"color:#94E2D5\">:\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> v1\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA\">kind\u003C/span>\u003Cspan style=\"color:#94E2D5\">:\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> Namespace\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA\">metadata\u003C/span>\u003Cspan style=\"color:#94E2D5\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA\">  name\u003C/span>\u003Cspan style=\"color:#94E2D5\">:\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> argocd\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"automating-everything-with-one-command\">Automating everything with one command\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#automating-everything-with-one-command\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h2>\n\u003Cp>To have one command setup everything: Terraform -> Pulumi -> storing kubeconfig &#x26; talosconfig I am using \u003Ca href=\"https://taskfile.dev/\">taskfile\u003C/a>.\u003C/p>\n\u003Cpre class=\"astro-code catppuccin-mocha\" style=\"background-color:#1e1e2e;color:#cdd6f4; overflow-x: auto;\" tabindex=\"0\" data-language=\"yaml\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA\">tasks\u003C/span>\u003Cspan style=\"color:#94E2D5\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA\">  default\u003C/span>\u003Cspan style=\"color:#94E2D5\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA\">    cmds\u003C/span>\u003Cspan style=\"color:#94E2D5\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">      -\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> terraform apply -auto-approve\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">      -\u003C/span>\u003Cspan style=\"color:#89B4FA\"> task\u003C/span>\u003Cspan style=\"color:#94E2D5\">:\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> configs\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA\">    silent\u003C/span>\u003Cspan style=\"color:#94E2D5\">:\u003C/span>\u003Cspan style=\"color:#FAB387\"> true\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA\">  configs\u003C/span>\u003Cspan style=\"color:#94E2D5\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA\">    cmds\u003C/span>\u003Cspan style=\"color:#94E2D5\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">      -\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> terraform output -raw talosconfig > ./talosconfig\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">      -\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> terraform output -raw kubeconfig > ./kubeconfig\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">      -\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> mv ./kubeconfig ~/.kube/config\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"resource-usage\">Resource Usage\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#resource-usage\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h2>\n\u003Cp>The cluster is just running Traefik, Sealed Secrets, Reflector, Longhorn, kube-prometheus-stack, External Secrets, Cloudnative PG, cert-manager and ArgoCD.\u003C/p>\n\u003Cp>Additionally there is a single Laravel app deployed with staging and prod environments.\u003C/p>\n\u003Cp>I have attached the screenshots of Node Exporter of each node:\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/free-production-kubernetes-cluster-usage-1.png&#x22;,&#x22;alt&#x22;:&#x22;&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/free-production-kubernetes-cluster-usage-2.png&#x22;,&#x22;alt&#x22;:&#x22;&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/free-production-kubernetes-cluster-usage-3.png&#x22;,&#x22;alt&#x22;:&#x22;&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Ch2 id=\"upgrading\">Upgrading\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#upgrading\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h2>\n\u003Ch3 id=\"kubernetes--talos\">Kubernetes &#x26; Talos\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#kubernetes--talos\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h3>\n\u003Cp>Not yet tested. Will update the article once I test it.\u003C/p>\n\u003Ch3 id=\"apps--dependencies\">Apps &#x26; Dependencies\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#apps--dependencies\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h3>\n\u003Cp>I use \u003Ca href=\"https://docs.renovatebot.com/\">Renovate\u003C/a> to keep my dependencies up to date. Nothing more to say, it works really well with Infrastructure as Code tools.\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/free-production-kubernetes-cluster-renovate.png&#x22;,&#x22;alt&#x22;:&#x22;&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Ch2 id=\"future-improvements\">Future improvements\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#future-improvements\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h2>\n\u003Cul>\n\u003Cli>Migrate Terraform to Pulumi.\u003C/li>\n\u003Cli>Remove dependency of uploading Talos Linux image.\u003C/li>\n\u003Cli>Use a library to programmatically port forward using OCI Bastion.\u003C/li>\n\u003Cli>Fully automated ArgoCD with sync waves for COMPLETELY automated bootstrap and deployment.\u003C/li>\n\u003Cli>Making ArgoCD environment adaptable for other people like easily change domain and it should work.\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"references\">References\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#references\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h2>\n\u003Cul>\n\u003Cli>\u003Ca href=\"https://github.com/navaneeth-dev/public-gitops/tree/main/infrastructure\">https://github.com/navaneeth-dev/public-gitops/tree/main/infrastructure\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"https://codefresh.io/blog/how-to-structure-your-argo-cd-repositories-using-application-sets/\">https://codefresh.io/blog/how-to-structure-your-argo-cd-repositories-using-application-sets/\u003C/a>\u003C/li>\n\u003C/ul>",{"headings":60,"localImagePaths":129,"remoteImagePaths":130,"frontmatter":131,"imagePaths":134},[61,65,68,71,74,77,80,83,86,89,93,96,99,102,105,108,111,114,117,120,123,126],{"depth":62,"slug":63,"text":64},2,"takeaway","Takeaway",{"depth":62,"slug":66,"text":67},"why-i-chose-oracle-cloud","Why I chose Oracle Cloud?",{"depth":62,"slug":69,"text":70},"what-is-a-hyperscaler","What is a hyperscaler?",{"depth":62,"slug":72,"text":73},"oracle-free-tier-explained","Oracle Free Tier Explained",{"depth":62,"slug":75,"text":76},"why-not-oci-kubernetes-engine-oke","Why not OCI Kubernetes Engine (OKE)?",{"depth":62,"slug":78,"text":79},"why-talos-linux","Why Talos Linux?",{"depth":62,"slug":81,"text":82},"prerequisites","Prerequisites",{"depth":62,"slug":84,"text":85},"architecture-diagram","Architecture diagram",{"depth":62,"slug":87,"text":88},"setting-up-terraform","Setting up Terraform",{"depth":90,"slug":91,"text":92},3,"setting-up-vms","Setting up VMs",{"depth":90,"slug":94,"text":95},"talos-linux-terraform","Talos Linux Terraform",{"depth":90,"slug":97,"text":98},"load-balancers","Load Balancers",{"depth":90,"slug":100,"text":101},"security","Security",{"depth":90,"slug":103,"text":104},"automating-ssh-port-forwarding-with-oci-bastion","Automating SSH Port Forwarding with OCI Bastion",{"depth":62,"slug":106,"text":107},"bootstrapping-argocd","Bootstrapping ArgoCD",{"depth":62,"slug":109,"text":110},"automating-everything-with-one-command","Automating everything with one command",{"depth":62,"slug":112,"text":113},"resource-usage","Resource Usage",{"depth":62,"slug":115,"text":116},"upgrading","Upgrading",{"depth":90,"slug":118,"text":119},"kubernetes--talos","Kubernetes & Talos",{"depth":90,"slug":121,"text":122},"apps--dependencies","Apps & Dependencies",{"depth":62,"slug":124,"text":125},"future-improvements","Future improvements",{"depth":62,"slug":127,"text":128},"references","References",[51,52,53,54,55],[],{"title":40,"tags":132,"pubDate":133,"image":17,"description":41,"author":22,"isDraft":47},[19,44,45,46],"May 6 2025",[51,52,53,54,55],"free-production-kubernetes-cluster.md","reverse-engineering-a-banking-app",{"id":136,"data":138,"body":147,"filePath":148,"assetImports":149,"digest":173,"rendered":174,"legacyId":227},{"title":139,"description":140,"pubDate":141,"image":142,"tags":143,"isDraft":47,"author":22},"Creating a custom UPI VPA by bypassing advanced anti-reversing techniques in a banking app","A deep dive into the process of generating custom UPI VPAs within a mobile banking app by bypassing security protections. Explore techniques for overcoming anti-reversing and Anti-Frida measures, including native library analysis.",["Date","2025-04-26T18:30:00.000Z"],"/icici.png",[144,145,146],"android","frida","reverse engineering","**Discussion links:** [r/Magisk](https://www.reddit.com/r/Magisk/comments/1ku2rre/article_creating_custom_upi_vpa_by_bypassing/) | [r/netsec](https://www.reddit.com/r/netsec/comments/1ku2sst/creating_custom_upi_vpa_by_bypassing_protecttai/)\n\n## Takeaway\n\n- Get a custom UPI VPA / UPI ID like `anything@bankxyz`.\n- Learn how to bypass and reverse engineer advanced anti reversing techniques.\n- Learn how to bypass Anti-Frida measures.\n- Learn how to reverse engineering Android native libraries.\n\nMy goal in starting this project was to create custom payment IDs where it would otherwise not have been possible. Advantages of having a short UPI ID include ease of remembering, an inside joke for friend groups and simpler to communicate. So what is a UPI ID?\n\n## UPI\n\nUnified Payments Interface is an Indian instant payment system as well as **protocol** developed by the National Payments Corporation of India (NPCI). Everyone in India use UPI for day to day payments, nobody uses cards for payments.\n\nUPI allows every bank (ICICI, Federal Bank) and third-party apps (GPay, PhonePe) to interact with each other.\n\nSo what is UPI ID? It is an alias for your bank account. In the case of HDFC bank app, we can have one UPI ID link to another bank for example: HDFC UPI ID for Federal Bank. A person can have several UPI IDs, for example one UPI ID for each app.\n\n## Initial analysis\n\nNow that I know we have the ability to choose the UPI IDs, I thought we can intercept the request and change the UPI ID to our desired one. With this I started analyzing the APK. First thing I always do is open JADX-GUI and look at the AndroidManifest.xml and MainActivity. To get the APK I used adb pull.\n\n![AndroidManifest - Finding main activity](../../images/reverse-engineering-icici.png)\n\nThe MainActivity extends `CordovaActivity` which means it's a React Native app, another way to find out if it's a React Native app is to check for the presence of `index.android.bundle`.\n\n![Cordova](../../images/reverse-engineering-icici-cordova.png)\n\n## Attempting to locate Anti-Frida detection \n\nAfter understanding what type of APK I will be dealing with, I started dynamic analysis with Frida so that I can easily verify if I am looking at the correct class from JADX. First thing I noticed after launching the app with Frida is the Frida connection closes immediately.\n\n![Process terminated Frida](../../images/reverse-engineering-icici-proc-term.png)\n\nSo this indicates Anti-Frida techniques. To trace which part of the code the Anti-Frida code is located I started hooking interesting functions which is called early. I used `Thread.sleep(10)` to check if the connection closes after 5 seconds that means the Anti-Frida code was already called before the hook. I also used `frida-trace -j 'CLASS!FUNCTION'` to check if a function is being called in the first place.\n\nAfter doing this for sometime I found that after `System.loadLibrary` is called the connection immediately closes. So this means a native library is doing the Anti-Frida stuff. Also I would always encounter a crash after hooking `System.loadLibrary` because of [this](https://github.com/rovo89/XposedBridge/issues/87):\n\n> This is one of the methods that you shouldn't hook. Have a look at the implementation: [https://android.googlesource.com/platform/libcore/+/android-6.0.1_r16/luni/src/main/java/java/lang/System.java#1072](https://android.googlesource.com/platform/libcore/+/android-6.0.1_r16/luni/src/main/java/java/lang/System.java#1072)\n> \n> It uses the class loader of the caller, which is usually the app, but would be Xposed as soon as you hook it. Please hook Runtime.loadLibrary() instead.\n\n![Load Library](../../images/reverse-engineering-icici-load-library.png)\n\nNow while I was running this in an Android 11 emulator I was not able to get the base address of the loaded module via `Process.findModuleByName` (which I was using to check whether the library was loaded fully so I can hook it's functions) but the library was loaded in memory with no module name. I suspect it's because of ARM translation going on and it was doing some sort of manual mapping. The APK only had arm64-v8a native libraries and no x86_64 library which was my emulator's architecture.\n\nSo going forward I did all my testing in my real Android device with MagiskHide turned off otherwise you cannot do early-instrumentation with `frida -U -f \u003Claunch-app>`.\n\nIn my real device I was able to hook `System.loadLibrary` and get the base address of the module right after it's been loaded. Example code:\n\n```js\nJava.perform(function() {\n    const System = Java.use('java.lang.System');\n    const Runtime = Java.use('java.lang.Runtime');\n    const SystemLoad_2 = System.loadLibrary.overload('java.lang.String');\n    const VMStack = Java.use('dalvik.system.VMStack');\n\n    SystemLoad_2.implementation = function(library) {\n        send(\"Loading dynamic library => \" + library);\n        try {\n            const loaded = Runtime.getRuntime().loadLibrary0(VMStack.getCallingClassLoader(), library);\n            if(library === 'libprotecttor-native-lib') {\n\t\t\t\t// hook native lib functions\n            }\n            return loaded;\n        } catch(ex) {\n            console.log(ex);\n        }\n    };\n});\n```\n\n\nNow that we have the ability to hook functions right after the native library is loaded. We can start reverse engineering the native library.\n\n## Protector Company\n\nThe library responsible for closing the Frida connection is `libprotecttor-native-lib.so`, so what is this native library? It is a RunTime Application Self-Protection solution developed by ~~[Censored](https://google.com)~~.\n\nOther native libraries important in XYZ bank app:\n\n| Name                            | Description                        | Hash                                                             |\n| ------------------------------- | ---------------------------------- | ---------------------------------------------------------------- |\n| libprotecttor-native-lib.so     | Main module                        | 124d6b42808c022d675c8eb5e928f2c810e5f5fe73b92fb019c4097f66cdc87d |\n| libapp-protecttor-native-lib.so | Rest of libprotectt, not important | 5ecdc71188e9fa6bc47fa23cd83bcbce95c2805fcc7754b25a275aa291893709 |\n| libnative-lib.so                | Gets API URL, not important        | 84445f13e7a1e39ba70f7ac3faaf5ac75354f0743a81f91b4bb586608c44a487 |\n\n## Extracting native libraries\n\nTo reverse engineer the native library I first have to get the .so files. First I checked the unzipped apk and didn't find any lib folder. After lots of research I found out about split apks and extractNativeLibs.\n\n`android:extractNativeLibs=\"false\"` means the main APK won't store any libraries but will instead store native libraries in architecture specific APKs to save download bandwidth.\n\n![Extract Native Libs False](../../images/reverse-engineering-icici-extract-native-false.png)\n*AndroidManifest.xml*\n\nHow to get split APK?\n\n```bash\n$ adb shell pm path com.csam.xyzbank.bank.imobile\npackage:/data/app/~~UOYiAXaSPBW0Ae8atXOrqg==/com.csam.xyzbank.bank.imobile-SYp1oonK6muaef0keHyLGw==/base.apk\npackage:/data/app/~~UOYiAXaSPBW0Ae8atXOrqg==/com.csam.xyzbank.bank.imobile-SYp1oonK6muaef0keHyLGw==/split_config.arm64_v8a.apk \u003C-- EXTRACT THIS\npackage:/data/app/~~UOYiAXaSPBW0Ae8atXOrqg==/com.csam.xyzbank.bank.imobile-SYp1oonK6muaef0keHyLGw==/split_config.xxhdpi.apk\n```\n\nNow we can just adb pull and the unzipped directory should have the libraries uncompressed.\n\n![Split APK Directory](../../images/reverse-engineering-icici-split-apk-dir.png)\n\n## Reverse engineering Android native libraries\n\nAfter loading `libprotecttor-native-lib.so` binary in IDA, (which I knew from my loadLibrary hook) I jumped into the entry point and found a thread being created with a startRoutine. It always verifies the checksum of the native library.\n\n![Native entry point](../../images/reverse-engineering-icici-native-entry-point.png)\n\nThe startRoutine finally calls the `F1` function which is just an infinite loop that calls two functions if the app is being used. If not it sleeps using the function `nanosleep` and checks again.\n\n![Main Thread](../../images/reverse-engineering-icici-mainThread.png)\n\n### Function 1 reversed\n\nWith the help of ChatGPT I was able to find out what this function does pretty fast. This function checks all thread names of the process via `/proc/self/task/%s/status` if it matches any of these:\n\n- gmain\n- gum-js-loop\n\nIf it does it calls it's exitClause which in turn calls `exit(1)` and does other things which is not very important.\n\nIt also checks if `strstr` or `opendir` has been hooked by comparing bytes with `libc.so` on disk.\n\n```c\n__int64 mwMainThread()\n{\n  ...omitted for brevity\n  v73 = *(_QWORD *)(_ReadStatusReg(ARM64_SYSREG(3, 3, 13, 0, 2)) + 40);\n  v0 = rotMinus2(\"/rtqe/ugnh/vcum==\");\n  dirPtr = opendir(v0);\n  if ( !dirPtr )\n  {\n    if ( check_open()\n      || (v50 = rotMinus2(\"qrgpfkt==\"), checkForFunctionHook(v50)) // opendir\n      || (v51 = rotMinus2(\"uvtuvt==\"), success = checkForFunctionHook(v51), (success & 1) != 0) ) // strstr\n    {\n      __android_log_print(4, \"AppProtectt\", \"G-M..1.1\");\n      v53 = \"et\";\nexitClause:\n      callScanCore(v53);\n      parse_maps_and_change_permissions();\n      exit(1);\n    }\n    goto LABEL_80;\n  }\n  v2 = dirPtr;\n  v3 = readdir(dirPtr);\n  if ( v3 )\n  {\n    v54 = 0;\n    while ( 1 )\n    {\n\t  ...omitted\n      procSelfTaskStatusFmtStr = rotMinus2(\"/rtqe/ugnh/vcum/%u/uvcvwu==\"); // /proc/self/task/%s/status\n      formatStr((__int64)taskSelfFmtBuf, 256LL, 256LL, procSelfTaskStatusFmtStr, v4);\n      v13 = linux_eabi_syscall(__NR_openat, -100, (const char *)taskSelfFmtBuf, 0x80000);\n      if ( v13 )\n      {\n        v14 = buffer;\n\t\t...omitted\n        gumJsLoop = rotMinus2(\"iwo-lu-nqqr==\"); // gum-js-loop\n        gmain = rotMinus2(\"iockp==\");           // gmain\n        v21 = gumJsLoop + 1;\n        if ( !*gumJsLoop )\n          goto gumExitClause;\ngumExitClause:\n          FK[0] = \"GA\";\n          __android_log_print(4, \"AppProtectt\", \"G-M..1\");\n          v53 = \"gum\";\n          goto exitClause;\n        }\n\t\t...\n        close(v13);\n      }\n\t...\n    if ( info1[0] == \"not found\" )\n      info1[0] = \"LEO\";\n  }\n  return success;\n}\n```\n\n### Function 2 reversed\n\nThis function is kinda of similar to the above function but checks if any file descriptor links to linjector. This is not important to Anti-Frida.\n\n```cpp\n__int64 sub_599EC()\n{\n  ...omitted for brevity\n  v52 = *(_QWORD *)(_ReadStatusReg(ARM64_SYSREG(3, 3, 13, 0, 2)) + 40);\n  v0 = rotMinus2(\"/rtqe/ugnh/hf==\"); // /proc/self/fd\n  v1 = opendir(v0);\n  v2 = v1;\n  if ( !v1 )\n  {\n    if ( check_open()\n      || (v27 = rotMinus2(\"qrgpfkt==\"), checkForFunctionHook(v27)) // opendir\n      || (v28 = rotMinus2(\"uvtuvt==\"), checkForFunctionHook(v28)) ) // strstr\n    {\n      __android_log_print(4, \"AppProtectt\", \"L-J..1.1\");\n      v30 = \"et\";\nexitClause:\n      callScanCore(v30);\n      parse_maps_and_change_permissions();\n      exit(1);\n    }\n    goto successClause;\n  }\n  v3 = readdir(v1);\n  if ( v3 )\n  {\n    v4 = v3;\n    v5 = 0;\n    while ( 1 )\n    {\n\t  ...\n      *(_OWORD *)file = 0u;\n      v36 = 0u;\n      v6 = rotMinus2(\"/rtqe/ugnh/hf/%u==\"); // /proc/self/fd/%s\n      formatStr((__int64)file, 256LL, 256LL, v6, v4->d_name);\n      lstat(file, (struct stat *)v31);\n      if ( (v32 & 0xF000) == 40960 )\n      {\n        v7 = linux_eabi_syscall(__NR_readlinkat, -100, file, (char *)v51, 0x100u);\n        linjector = rotMinus2(\"nkplgevqt==\"); // linjector\n        if ( (v5 & 1) == 0 )\n        {\n          pid = getpid();\n          formatStr((__int64)&buf, 32LL, 32LL, \"%s%s%s%d%s\", \"pr\", \"oc\", \"/\", pid, \"/fd\");\n...\nexitClauseParent:\n          FK[0] = \"LFA\";\n          __android_log_print(4, \"AppProtectt\", \"L-J..1\");\n          v30 = \"lin\";\n          goto exitClause;\n        }\n      v4 = readdir(v2);\n...\nsuccessClause:\n    if ( globalStatus == \"not found\" )\n      globalStatus = \"LEO\";\n  }\n  return closedir(v2);\n}\n```\n\n## Bypassing native library checks\n\nWhen checking my phone, I was being detected because Frida creates a gmain thread. There are many ways to bypass this but I just hooked these two functions.\n\nThe way I did that is by hooking  `pthread_create` and after registering the startRoutine hook, I hook the two functions. I just add an offset from the base address because this is a temporary project. After the library is loaded I unhook `pthread_create`.\n\n```js\n    let threadHook = null;\n    const pthread_create_ptr = Module.findExportByName(null, \"pthread_create\");\n    console.log(\"[+] Found pthread_create at: \" + pthread_create_ptr);\n    System.loadLibrary.implementation = function(library) {\n        if (library == \"protectt-native-lib\") {\n            threadHook = Interceptor.attach(pthread_create_ptr, {\n                onEnter: function(args) {\n                    this.threadPtr = args[0];\n                    this.startRoutine = args[2];\n                    this.routineArg = args[3];\n\n                    // Hooking first startRoutine after libprotectt is loaded is enough\n                    if (!hooked) {\n                        const startRoutineHook = Interceptor.replace(this.startRoutine, new NativeCallback(() => {\n                            console.log(\"[+] Thread function started\");\n\n                            var targetModule = Process.findModuleByName(\"libprotectt-native-lib.so\");\n                            if (targetModule) {\n                                const baseAddr = targetModule.base;\n\n                                Interceptor.replace(baseAddr.add(0x59E24), new NativeCallback(() => {\n                                    console.log(\"[+] mainThread Hook\");\n                                }, 'void', []));\n\n                                Interceptor.replace(baseAddr.add(0x599EC), new NativeCallback(() => {\n                                    console.log(\"[+] mainThread2 Hook\");\n                                }, 'void', []));\n                            }\n                        }, 'void', ['pointer']));\n\n                        hooked = true;\n                        threadHook.detach();\n                    }\n                },\n            });\n        }\n\n        Runtime.getRuntime().loadLibrary0(VMStack.getCallingClassLoader(), library);\n        const classLoader = VMStack.getCallingClassLoader();\n\n        if (library == \"protectt-native-lib\" && threadHook) {\n            threadHook.detach();\n            threadHook = null;\n        }\n    };\n```\n\n## Bypassing root detection\n\nWith this I was able to bypass the Anti-Frida detection but now I was getting root detected. \n\n![Root Detection](../../images/reverse-engineering-icici-root-detection.png)\n\nSo I tried searching for the string \"Your Device is rooted. For security reasons...\" in the APK but no results were found. I searched in `/data/data` and `/data/user` still no results.\n\nWith no luck I tried searching for \"Close App\" again no luck. I tried with case insensitive and partial strings like \"Your Device\" etc... Still no luck.\n\nI decided to change my approach and search for Android APIs that exit the app, [Stackoverflow](https://stackoverflow.com/questions/17719634/how-to-exit-an-android-app-programmatically) has a good list.\n\n\n- finishAffinity\n- finishAndRemoveTask\n- getActivity().finish();\n- System.exit(0)\n\nI tried searching for these with JADX code search and found a few interesting functions. It's likely only the main one's are relevant. And we focus our search inside the ai package.\n\n![System.exit functions](../../images/reverse-engineering-icici-system-exit.png)\n\nAfter seeing a few of these functions there is a common function `companion.d()`. It's called by everything that closes the apps. So instead of hooking all the above functions, we can just hook one and get the stacktrace.\n\n![Common code](../../images/reverse-engineering-icici-common.png)\n\nI hook this so I can see what exactly is calling it up the stack. So I can hook the parent function and bypass the root detection. This was by far the hardest part because there is at least 25 functions that need to be traced up the stack using Frida + JADX. I found several ways to bypass ~~Censored~~ but I will be showing part of the process as the actual process is TOO long and I am not able to retrace what I did lol.\n\n```js\nlet a = Java.use(\"protecttor.app.security.main.g$a\");\na[\"d\"].implementation = function () {\n\tconsole.log(`a.d is called`);\n\tlet result = this[\"d\"]();\n\tconsole.log(`a.d result=${result}`);\n\tconsole.log(Java.use(\"android.util.Log\").getStackTraceString(Java.use(\"java.lang.Exception\").$new()))\n\treturn result;\n};\n```\n\nOnce we click \"Close App\" the last stack trace should give us the correct function. \n\n```bash\na.d is called\na.d result=[object Object]\njava.lang.Exception\n        at protecttor.app.security.main.g$a.d(Native Method)\n        at protecttor.app.security.main.scan.ScanAlerts.x(Unknown Source:49)\n        at protecttor.app.security.main.scan.ScanAlerts.V(Unknown Source:11)\n        at protecttor.app.security.main.scan.ScanAlerts.d0(Unknown Source:3)\n        at protecttor.app.security.main.scan.ScanAlerts.f(Unknown Source:0)\n        at protecttor.app.security.main.scan.t.onClick(Unknown Source:4)\n        at android.view.View.performClick(View.java:8028)\n        at android.view.View.performClickInternal(View.java:8005)\n        at android.view.View.-$$Nest$mperformClickInternal(Unknown Source:0)\n        at android.view.View$PerformClick.run(View.java:31233)\n        at android.os.Handler.handleCallback(Handler.java:959)\n        at android.os.Handler.dispatchMessage(Handler.java:100)\n        at android.os.Looper.loopOnce(Looper.java:258)\n        at android.os.Looper.loop(Looper.java:356)\n        at android.app.ActivityThread.main(ActivityThread.java:8837)\n        at java.lang.reflect.Method.invoke(Native Method)\n        at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:598)\n        at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:896)\n```\n\n![](../../images/reverse-engineering-icici-t-click.png)\n\n```\nScanAlerts.U is called: btnBlock=androidx.appcompat.widget.AppCompatButton{6e89fa8 VFED..C.. ......I. 0,0-0,0 #7f0a03a7 app:id/btn_sdk_btn_block}, mBuilder=android.app.AlertDialog@5a\n15ac1, btnIgnore=androidx.appcompat.widget.AppCompatButton{1a0a266 VFED..C.. ......I. 0,0-0,0 #7f0a03a8 app:id/btn_sdk_btn_ignore}, response=Java.Field{                              \n        holder: protecttor.app.security.shouldnotobfuscated.dto.i@3c469a7,                \n        fieldType: 2,                                                                                                                                                                 \n        fieldReturnType: Ljava/lang/String;,                                                                                                                                          \n        value: Your Device is rooted. For security reasons we have stopped the Mobile Banking Services on rooted devices.,                                                            \n}, checkBoxForceAccept=androidx.appcompat.widget.AppCompatCheckBox{fc0e54 GFED..C.. ......I. 0,0-0,0 #7f0a0885 app:id/force_accept}                                                   \n[+] Spoofing adb_enabled to 0 (OFF)                                                                                                                                                   \njava.lang.Exception                                                                                                                                                                   \n        at protecttor.app.security.main.scan.ScanAlerts.U(Native Method)                                                                                                             \n        at protecttor.app.security.main.scan.ScanAlerts.C(Unknown Source:1084)                                                                                                       \n        at protecttor.app.security.main.scan.ScanAlerts.a0(Unknown Source:289)                                                                                                       \n        at protecttor.app.security.main.g.C1(Unknown Source:10)                                                                                                                      \n        at protecttor.app.security.main.g.o(Unknown Source:0)                                                                                                                        \n        at protecttor.app.security.main.c.run(Unknown Source:2)\n        at android.os.Handler.handleCallback(Handler.java:959\n```\n\n![](../../images/reverse-engineering-icici-b1.png)\n\nKeep repeating this process and trying things, you should trace it to a call in `IMOBILE` or `IMobileApplication`. I will now move onto the findings.\n\n![](../../images/reverse-engineering-icici-b1-parent.png)\n\n### IMOBILE.onCreate\n\n`com.csam.xyzbank.bank.imobile.IMOBILE.onCreate` calls `getLoggingStatus`. This function has nothing to do with logging but does security checks, ~~Censored~~ is known to misdirect reverse researchers using fake naming, calling the actual function in an error exception, using decoy functions, among other techniques.\n\n![](../../images/reverse-engineering-icici-oncreate.png)\n\n`getLoggingStatus` is a native function, we have to check all native libraries for this JNI function.\n\n![](../../images/reverse-engineering-icici-get-logging-status.png)\n\nThe function was located in `libnative-lib.so`, IDA shows it calls the function `com.csam.xyzbank.bank.imobile.IMOBILE.logStatus()`.\n\n![](../../images/reverse-engineering-icici-native-logging.png)\n\nHere we finally see `logStatus` calls `log` and in turn calls some security checks.\n\n![](../../images/reverse-engineering-icici-dsgf.png)\n\n### IMOBILE.onResume\n\nWe just need to hook `wVar.m(this, this);` and `protecttor.app.security.common.helper.h0.f1361a.z(this, this)`.\n\n![](../../images/reverse-engineering-icici-onresume-checks.png)\n\n### Root bypass script\n\nThese are all the security checks called from the MainActivity, we want to block everything from the root so it doesn't run in the background or start some `Timer`. Finally putting all the bypasses together we get:\n\n```js\n// Native library calls from IMOBILE.onCreate\nlet IMOBILE = Java.use(\"com.csam.xyzbank.bank.imobile.IMOBILE\");\nIMOBILE[\"logStatus\"].implementation = function () {\n\tconsole.log(`IMOBILE.logStatus is called`);\n};\n\n// ActivityLifecycleCallbacks\nlet LoggerController = Java.use(\"protecttor.app.security.main.LoggerController\");\nLoggerController[\"i\"].implementation = function (context, activity) {\n\tconsole.log(`LoggerController.i is called: context=${context}, activity=${activity}`);\n};\n\n// IMOBILE.onResume Check1\nlet h0 = Java.use(\"protecttor.app.security.common.helper.h0\");\nh0[\"z\"].implementation = function (context, activity) {\nconsole.log(`h0.z is called: context=${context}, activity=${activity}`);\n};\n\n// IMOBILE.onResume Check2\nlet w = Java.use(\"protecttor.app.security.common.helper.w\");\nw[\"m\"].implementation = function (context, activity) {\n\tconsole.log(`w.m is called: context=${context}, activity=${activity}`);\n};\n```\n\n## Finally getting a custom VPA\n\nAfter launching my script with [https://codeshare.frida.re/@akabe1/frida-multiple-unpinning/](https://codeshare.frida.re/@akabe1/frida-multiple-unpinning/) I was able to view the HTTPS traffic. But unfortunately it was encrypted so we can't just modify the request.\n\n![](../../images/reverse-engineering-icici-zap.png)\n\nLets search for the string \"encResponse\" so we can print the strings as it's being encrypted and decrypted. There were only 2 relevant results and one function is a wrapper for the below function so lets hook it. This condition calls `w0` if the JSON has `encResponse`.\n\n![](../../images/reverse-engineering-icici-dsf.png)\n\nw0 calls `com.Discover.Security.a` etc. These are the functions we want to hook. We need to hook all the functions in these classes because which function is chosen is random.\n\n![](../../images/reverse-engineering-icici-truirt.png)\n\nThis above screenshot is only for decryption, so the code I used to hook all encryption and decryption functions is:\n\n```js\nlet a = Java.use(\"com.Discover.Security.a\");\na[\"a\"].implementation = function (textToDecrypt) {\n\tlet result = this[\"a\"](textToDecrypt);\n\tconsole.log(`a.a result=${result}`);\n\treturn result;\n};\na[\"b\"].implementation = function (textToEncrypt) {\n\tconsole.log(`a.b is called: textToEncrypt=${textToEncrypt}`);\n\tlet result = this[\"b\"](textToEncrypt);\n\tconsole.log(`a.b result=${result}`);\n\treturn result;\n};\n\nlet b = Java.use(\"com.Discover.Security.b\");\nb[\"a\"].implementation = function (key, encryptedValue) {\n\tlet result = this[\"a\"](key, encryptedValue);\n\tconsole.log(\"Response\", JSON.stringify(JSON.parse(result), null, 4));\n\treturn result;\n};\nb[\"b\"].implementation = function (key, value) {\n\tconsole.log(`com.Discover.Security.b.b secureString ${key}`);\n\n\tconst json = JSON.parse(value, null, 4);\n\tconsole.log(JSON.stringify(json, null, 4));\n\n\tlet result = this[\"b\"](key, value);\n\treturn result;\n};\n```\n\nNow that we can see the traffic, I wanted to check the JSON sent just before clicking create UPI ID. There is a VPA attribute which we can modify to our desired one. There are many ways to do this but I just hard coded the VPA in my Frida script. Unfortunately no screenshot for this. During my testing a UPI ID of at least 5 characters was required. All you need to do to get a custom UPI ID is modify the above code to this:\n\n```js\nb[\"b\"].implementation = function (key, value) {\n\tconsole.log(`com.Discover.Security.b.b secureString ${key}`);\n\n\tconst json = JSON.parse(value, null, 4);\n\tif (json.VPA === \"upi_id_from_the_list\") {\n\t\tjson.VPA = \"YOUR_DESIRED_ID@bankxyz\";\n\t\tconsole.log(\"CHANGED VPA\");\n\t\tvalue = JSON.stringify(json);\n\t}\n\n\tconsole.log(JSON.stringify(json, null, 4));\n\n\tlet result = this[\"b\"](key, value);\n\treturn result;\n};\n```\n\nAnd voila!\n\n![](../../images/customid.png)","src/content/blog/reverse-engineering-a-banking-app.md",[150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172],"../../images/reverse-engineering-icici.png","../../images/reverse-engineering-icici-cordova.png","../../images/reverse-engineering-icici-proc-term.png","../../images/reverse-engineering-icici-load-library.png","../../images/reverse-engineering-icici-extract-native-false.png","../../images/reverse-engineering-icici-split-apk-dir.png","../../images/reverse-engineering-icici-native-entry-point.png","../../images/reverse-engineering-icici-mainThread.png","../../images/reverse-engineering-icici-root-detection.png","../../images/reverse-engineering-icici-system-exit.png","../../images/reverse-engineering-icici-common.png","../../images/reverse-engineering-icici-t-click.png","../../images/reverse-engineering-icici-b1.png","../../images/reverse-engineering-icici-b1-parent.png","../../images/reverse-engineering-icici-oncreate.png","../../images/reverse-engineering-icici-get-logging-status.png","../../images/reverse-engineering-icici-native-logging.png","../../images/reverse-engineering-icici-dsgf.png","../../images/reverse-engineering-icici-onresume-checks.png","../../images/reverse-engineering-icici-zap.png","../../images/reverse-engineering-icici-dsf.png","../../images/reverse-engineering-icici-truirt.png","../../images/customid.png","ff8c5dade4382f86",{"html":175,"metadata":176},"\u003Cp>\u003Cstrong>Discussion links:\u003C/strong> \u003Ca href=\"https://www.reddit.com/r/Magisk/comments/1ku2rre/article_creating_custom_upi_vpa_by_bypassing/\">r/Magisk\u003C/a> | \u003Ca href=\"https://www.reddit.com/r/netsec/comments/1ku2sst/creating_custom_upi_vpa_by_bypassing_protecttai/\">r/netsec\u003C/a>\u003C/p>\n\u003Ch2 id=\"takeaway\">Takeaway\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#takeaway\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h2>\n\u003Cul>\n\u003Cli>Get a custom UPI VPA / UPI ID like \u003Ccode>anything@bankxyz\u003C/code>.\u003C/li>\n\u003Cli>Learn how to bypass and reverse engineer advanced anti reversing techniques.\u003C/li>\n\u003Cli>Learn how to bypass Anti-Frida measures.\u003C/li>\n\u003Cli>Learn how to reverse engineering Android native libraries.\u003C/li>\n\u003C/ul>\n\u003Cp>My goal in starting this project was to create custom payment IDs where it would otherwise not have been possible. Advantages of having a short UPI ID include ease of remembering, an inside joke for friend groups and simpler to communicate. So what is a UPI ID?\u003C/p>\n\u003Ch2 id=\"upi\">UPI\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#upi\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h2>\n\u003Cp>Unified Payments Interface is an Indian instant payment system as well as \u003Cstrong>protocol\u003C/strong> developed by the National Payments Corporation of India (NPCI). Everyone in India use UPI for day to day payments, nobody uses cards for payments.\u003C/p>\n\u003Cp>UPI allows every bank (ICICI, Federal Bank) and third-party apps (GPay, PhonePe) to interact with each other.\u003C/p>\n\u003Cp>So what is UPI ID? It is an alias for your bank account. In the case of HDFC bank app, we can have one UPI ID link to another bank for example: HDFC UPI ID for Federal Bank. A person can have several UPI IDs, for example one UPI ID for each app.\u003C/p>\n\u003Ch2 id=\"initial-analysis\">Initial analysis\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#initial-analysis\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h2>\n\u003Cp>Now that I know we have the ability to choose the UPI IDs, I thought we can intercept the request and change the UPI ID to our desired one. With this I started analyzing the APK. First thing I always do is open JADX-GUI and look at the AndroidManifest.xml and MainActivity. To get the APK I used adb pull.\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/reverse-engineering-icici.png&#x22;,&#x22;alt&#x22;:&#x22;AndroidManifest - Finding main activity&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Cp>The MainActivity extends \u003Ccode>CordovaActivity\u003C/code> which means it’s a React Native app, another way to find out if it’s a React Native app is to check for the presence of \u003Ccode>index.android.bundle\u003C/code>.\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/reverse-engineering-icici-cordova.png&#x22;,&#x22;alt&#x22;:&#x22;Cordova&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Ch2 id=\"attempting-to-locate-anti-frida-detection\">Attempting to locate Anti-Frida detection\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#attempting-to-locate-anti-frida-detection\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h2>\n\u003Cp>After understanding what type of APK I will be dealing with, I started dynamic analysis with Frida so that I can easily verify if I am looking at the correct class from JADX. First thing I noticed after launching the app with Frida is the Frida connection closes immediately.\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/reverse-engineering-icici-proc-term.png&#x22;,&#x22;alt&#x22;:&#x22;Process terminated Frida&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Cp>So this indicates Anti-Frida techniques. To trace which part of the code the Anti-Frida code is located I started hooking interesting functions which is called early. I used \u003Ccode>Thread.sleep(10)\u003C/code> to check if the connection closes after 5 seconds that means the Anti-Frida code was already called before the hook. I also used \u003Ccode>frida-trace -j 'CLASS!FUNCTION'\u003C/code> to check if a function is being called in the first place.\u003C/p>\n\u003Cp>After doing this for sometime I found that after \u003Ccode>System.loadLibrary\u003C/code> is called the connection immediately closes. So this means a native library is doing the Anti-Frida stuff. Also I would always encounter a crash after hooking \u003Ccode>System.loadLibrary\u003C/code> because of \u003Ca href=\"https://github.com/rovo89/XposedBridge/issues/87\">this\u003C/a>:\u003C/p>\n\u003Cblockquote>\n\u003Cp>This is one of the methods that you shouldn’t hook. Have a look at the implementation: \u003Ca href=\"https://android.googlesource.com/platform/libcore/+/android-6.0.1_r16/luni/src/main/java/java/lang/System.java#1072\">https://android.googlesource.com/platform/libcore/+/android-6.0.1_r16/luni/src/main/java/java/lang/System.java#1072\u003C/a>\u003C/p>\n\u003Cp>It uses the class loader of the caller, which is usually the app, but would be Xposed as soon as you hook it. Please hook Runtime.loadLibrary() instead.\u003C/p>\n\u003C/blockquote>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/reverse-engineering-icici-load-library.png&#x22;,&#x22;alt&#x22;:&#x22;Load Library&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Cp>Now while I was running this in an Android 11 emulator I was not able to get the base address of the loaded module via \u003Ccode>Process.findModuleByName\u003C/code> (which I was using to check whether the library was loaded fully so I can hook it’s functions) but the library was loaded in memory with no module name. I suspect it’s because of ARM translation going on and it was doing some sort of manual mapping. The APK only had arm64-v8a native libraries and no x86_64 library which was my emulator’s architecture.\u003C/p>\n\u003Cp>So going forward I did all my testing in my real Android device with MagiskHide turned off otherwise you cannot do early-instrumentation with \u003Ccode>frida -U -f &#x3C;launch-app>\u003C/code>.\u003C/p>\n\u003Cp>In my real device I was able to hook \u003Ccode>System.loadLibrary\u003C/code> and get the base address of the module right after it’s been loaded. Example code:\u003C/p>\n\u003Cpre class=\"astro-code catppuccin-mocha\" style=\"background-color:#1e1e2e;color:#cdd6f4; overflow-x: auto;\" tabindex=\"0\" data-language=\"js\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">Java\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">perform\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#CBA6F7\">function\u003C/span>\u003Cspan style=\"color:#9399B2\">()\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">    const\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> System \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> Java\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">use\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">'java.lang.System'\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">    const\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> Runtime \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> Java\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">use\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">'java.lang.Runtime'\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">    const\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> SystemLoad_2 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> System\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">loadLibrary\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">overload\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">'java.lang.String'\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">    const\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> VMStack \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> Java\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">use\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">'dalvik.system.VMStack'\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">    SystemLoad_2\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">implementation\u003C/span>\u003Cspan style=\"color:#94E2D5\"> =\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> function\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#EBA0AC;font-style:italic\">library\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">        send\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"Loading dynamic library => \"\u003C/span>\u003Cspan style=\"color:#94E2D5\"> +\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> library)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">        try\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">            const\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> loaded \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> Runtime\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">getRuntime\u003C/span>\u003Cspan style=\"color:#CDD6F4\">()\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">loadLibrary0\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(VMStack\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">getCallingClassLoader\u003C/span>\u003Cspan style=\"color:#CDD6F4\">()\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> library)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">            if\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(library \u003C/span>\u003Cspan style=\"color:#94E2D5\">===\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> 'libprotecttor-native-lib'\u003C/span>\u003Cspan style=\"color:#CDD6F4\">) \u003C/span>\u003Cspan style=\"color:#9399B2\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2;font-style:italic\">\t\t\t\t// hook native lib functions\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">            }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">            return\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> loaded\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">        }\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> catch\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(ex) \u003C/span>\u003Cspan style=\"color:#9399B2\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">            console\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">log\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(ex)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">    };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">}\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Now that we have the ability to hook functions right after the native library is loaded. We can start reverse engineering the native library.\u003C/p>\n\u003Ch2 id=\"protector-company\">Protector Company\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#protector-company\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h2>\n\u003Cp>The library responsible for closing the Frida connection is \u003Ccode>libprotecttor-native-lib.so\u003C/code>, so what is this native library? It is a RunTime Application Self-Protection solution developed by \u003Cdel>\u003Ca href=\"https://google.com\">Censored\u003C/a>\u003C/del>.\u003C/p>\n\u003Cp>Other native libraries important in XYZ bank app:\u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Name\u003C/th>\u003Cth>Description\u003C/th>\u003Cth>Hash\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>libprotecttor-native-lib.so\u003C/td>\u003Ctd>Main module\u003C/td>\u003Ctd>124d6b42808c022d675c8eb5e928f2c810e5f5fe73b92fb019c4097f66cdc87d\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>libapp-protecttor-native-lib.so\u003C/td>\u003Ctd>Rest of libprotectt, not important\u003C/td>\u003Ctd>5ecdc71188e9fa6bc47fa23cd83bcbce95c2805fcc7754b25a275aa291893709\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>libnative-lib.so\u003C/td>\u003Ctd>Gets API URL, not important\u003C/td>\u003Ctd>84445f13e7a1e39ba70f7ac3faaf5ac75354f0743a81f91b4bb586608c44a487\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Ch2 id=\"extracting-native-libraries\">Extracting native libraries\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#extracting-native-libraries\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h2>\n\u003Cp>To reverse engineer the native library I first have to get the .so files. First I checked the unzipped apk and didn’t find any lib folder. After lots of research I found out about split apks and extractNativeLibs.\u003C/p>\n\u003Cp>\u003Ccode>android:extractNativeLibs=\"false\"\u003C/code> means the main APK won’t store any libraries but will instead store native libraries in architecture specific APKs to save download bandwidth.\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/reverse-engineering-icici-extract-native-false.png&#x22;,&#x22;alt&#x22;:&#x22;Extract Native Libs False&#x22;,&#x22;index&#x22;:0}\">\n\u003Cem>AndroidManifest.xml\u003C/em>\u003C/p>\n\u003Cp>How to get split APK?\u003C/p>\n\u003Cpre class=\"astro-code catppuccin-mocha\" style=\"background-color:#1e1e2e;color:#cdd6f4; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">$\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> adb\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> shell\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> pm\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> path\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> com.csam.xyzbank.bank.imobile\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">package:/data/app/~~UOYiAXaSPBW0Ae8atXOrqg\u003C/span>\u003Cspan style=\"color:#A6E3A1\">==/com.csam.xyzbank.bank.imobile-SYp1oonK6muaef0keHyLGw==/base.apk\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">package:/data/app/~~UOYiAXaSPBW0Ae8atXOrqg\u003C/span>\u003Cspan style=\"color:#A6E3A1\">==/com.csam.xyzbank.bank.imobile-SYp1oonK6muaef0keHyLGw==/split_config.arm64_v8a.apk\u003C/span>\u003Cspan style=\"color:#94E2D5\"> &#x3C;\u003C/span>\u003Cspan style=\"color:#A6E3A1\">--\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> EXTRACT\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> THIS\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">package:/data/app/~~UOYiAXaSPBW0Ae8atXOrqg\u003C/span>\u003Cspan style=\"color:#A6E3A1\">==/com.csam.xyzbank.bank.imobile-SYp1oonK6muaef0keHyLGw==/split_config.xxhdpi.apk\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Now we can just adb pull and the unzipped directory should have the libraries uncompressed.\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/reverse-engineering-icici-split-apk-dir.png&#x22;,&#x22;alt&#x22;:&#x22;Split APK Directory&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Ch2 id=\"reverse-engineering-android-native-libraries\">Reverse engineering Android native libraries\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#reverse-engineering-android-native-libraries\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h2>\n\u003Cp>After loading \u003Ccode>libprotecttor-native-lib.so\u003C/code> binary in IDA, (which I knew from my loadLibrary hook) I jumped into the entry point and found a thread being created with a startRoutine. It always verifies the checksum of the native library.\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/reverse-engineering-icici-native-entry-point.png&#x22;,&#x22;alt&#x22;:&#x22;Native entry point&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Cp>The startRoutine finally calls the \u003Ccode>F1\u003C/code> function which is just an infinite loop that calls two functions if the app is being used. If not it sleeps using the function \u003Ccode>nanosleep\u003C/code> and checks again.\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/reverse-engineering-icici-mainThread.png&#x22;,&#x22;alt&#x22;:&#x22;Main Thread&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Ch3 id=\"function-1-reversed\">Function 1 reversed\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#function-1-reversed\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h3>\n\u003Cp>With the help of ChatGPT I was able to find out what this function does pretty fast. This function checks all thread names of the process via \u003Ccode>/proc/self/task/%s/status\u003C/code> if it matches any of these:\u003C/p>\n\u003Cul>\n\u003Cli>gmain\u003C/li>\n\u003Cli>gum-js-loop\u003C/li>\n\u003C/ul>\n\u003Cp>If it does it calls it’s exitClause which in turn calls \u003Ccode>exit(1)\u003C/code> and does other things which is not very important.\u003C/p>\n\u003Cp>It also checks if \u003Ccode>strstr\u003C/code> or \u003Ccode>opendir\u003C/code> has been hooked by comparing bytes with \u003Ccode>libc.so\u003C/code> on disk.\u003C/p>\n\u003Cpre class=\"astro-code catppuccin-mocha\" style=\"background-color:#1e1e2e;color:#cdd6f4; overflow-x: auto;\" tabindex=\"0\" data-language=\"c\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">__int64 \u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">mwMainThread\u003C/span>\u003Cspan style=\"color:#9399B2\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  ...omitted \u003C/span>\u003Cspan style=\"color:#CBA6F7\">for\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> brevity\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  v73 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#94E2D5\"> *\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#CDD6F4\">_QWORD \u003C/span>\u003Cspan style=\"color:#94E2D5\">*\u003C/span>\u003Cspan style=\"color:#9399B2\">)(\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">_ReadStatusReg\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">ARM64_SYSREG\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#FAB387\">3\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#FAB387\"> 3\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#FAB387\"> 13\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#FAB387\"> 0\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#FAB387\"> 2\u003C/span>\u003Cspan style=\"color:#9399B2\">))\u003C/span>\u003Cspan style=\"color:#94E2D5\"> +\u003C/span>\u003Cspan style=\"color:#FAB387\"> 40\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  v0 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> rotMinus2\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"/rtqe/ugnh/vcum==\"\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  dirPtr \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> opendir\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#CDD6F4\">v0\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">  if\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#94E2D5\"> !\u003C/span>\u003Cspan style=\"color:#CDD6F4\">dirPtr \u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">  {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">    if\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> check_open\u003C/span>\u003Cspan style=\"color:#9399B2\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#94E2D5\">      ||\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#CDD6F4\">v50 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> rotMinus2\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"qrgpfkt==\"\u003C/span>\u003Cspan style=\"color:#9399B2\">),\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> checkForFunctionHook\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#CDD6F4\">v50\u003C/span>\u003Cspan style=\"color:#9399B2\">))\u003C/span>\u003Cspan style=\"color:#9399B2;font-style:italic\"> // opendir\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#94E2D5\">      ||\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#CDD6F4\">v51 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> rotMinus2\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"uvtuvt==\"\u003C/span>\u003Cspan style=\"color:#9399B2\">),\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> success \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> checkForFunctionHook\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#CDD6F4\">v51\u003C/span>\u003Cspan style=\"color:#9399B2\">),\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#CDD6F4\">success \u003C/span>\u003Cspan style=\"color:#94E2D5\">&#x26;\u003C/span>\u003Cspan style=\"color:#FAB387\"> 1\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003Cspan style=\"color:#94E2D5\"> !=\u003C/span>\u003Cspan style=\"color:#FAB387\"> 0\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003Cspan style=\"color:#9399B2\"> )\u003C/span>\u003Cspan style=\"color:#9399B2;font-style:italic\"> // strstr\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">    {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">      __android_log_print\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#FAB387\">4\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"AppProtectt\"\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"G-M..1.1\"\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">      v53 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"et\"\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">exitClause:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">      callScanCore\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#CDD6F4\">v53\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">      parse_maps_and_change_permissions\u003C/span>\u003Cspan style=\"color:#9399B2\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">      exit\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#FAB387\">1\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">    goto\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> LABEL_80\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  v2 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> dirPtr\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  v3 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> readdir\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#CDD6F4\">dirPtr\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">  if\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> v3 \u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">  {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">    v54 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#FAB387\"> 0\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">    while\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#FAB387\"> 1\u003C/span>\u003Cspan style=\"color:#9399B2\"> )\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">    {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">\t  ...omitted\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">      procSelfTaskStatusFmtStr \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> rotMinus2\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"/rtqe/ugnh/vcum/%u/uvcvwu==\"\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003Cspan style=\"color:#9399B2;font-style:italic\"> // /proc/self/task/%s/status\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">      formatStr\u003C/span>\u003Cspan style=\"color:#9399B2\">((\u003C/span>\u003Cspan style=\"color:#CDD6F4\">__int64\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003Cspan style=\"color:#CDD6F4\">taskSelfFmtBuf\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#FAB387\"> 256\u003C/span>\u003Cspan style=\"color:#CBA6F7\">LL\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#FAB387\"> 256\u003C/span>\u003Cspan style=\"color:#CBA6F7\">LL\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> procSelfTaskStatusFmtStr\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> v4\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">      v13 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> linux_eabi_syscall\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#CDD6F4\">__NR_openat\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#94E2D5\"> -\u003C/span>\u003Cspan style=\"color:#FAB387\">100\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#CBA6F7\">const\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> char\u003C/span>\u003Cspan style=\"color:#94E2D5\"> *\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003Cspan style=\"color:#CDD6F4\">taskSelfFmtBuf\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> 0x\u003C/span>\u003Cspan style=\"color:#FAB387\">80000\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">      if\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> v13 \u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">      {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">        v14 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> buffer\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">\t\t...omitted\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">        gumJsLoop \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> rotMinus2\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"iwo-lu-nqqr==\"\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003Cspan style=\"color:#9399B2;font-style:italic\"> // gum-js-loop\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">        gmain \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> rotMinus2\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"iockp==\"\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003Cspan style=\"color:#9399B2;font-style:italic\">           // gmain\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">        v21 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> gumJsLoop \u003C/span>\u003Cspan style=\"color:#94E2D5\">+\u003C/span>\u003Cspan style=\"color:#FAB387\"> 1\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">        if\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#94E2D5\"> !*\u003C/span>\u003Cspan style=\"color:#CDD6F4\">gumJsLoop \u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">          goto\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> gumExitClause\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">gumExitClause:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">          FK\u003C/span>\u003Cspan style=\"color:#9399B2\">[\u003C/span>\u003Cspan style=\"color:#FAB387\">0\u003C/span>\u003Cspan style=\"color:#9399B2\">]\u003C/span>\u003Cspan style=\"color:#94E2D5\"> =\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"GA\"\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">          __android_log_print\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#FAB387\">4\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"AppProtectt\"\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"G-M..1\"\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">          v53 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"gum\"\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">          goto\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> exitClause\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">\t\t...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">        close\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#CDD6F4\">v13\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">      }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">\t...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">    if\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> info1\u003C/span>\u003Cspan style=\"color:#9399B2\">[\u003C/span>\u003Cspan style=\"color:#FAB387\">0\u003C/span>\u003Cspan style=\"color:#9399B2\">]\u003C/span>\u003Cspan style=\"color:#94E2D5\"> ==\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"not found\"\u003C/span>\u003Cspan style=\"color:#9399B2\"> )\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">      info1\u003C/span>\u003Cspan style=\"color:#9399B2\">[\u003C/span>\u003Cspan style=\"color:#FAB387\">0\u003C/span>\u003Cspan style=\"color:#9399B2\">]\u003C/span>\u003Cspan style=\"color:#94E2D5\"> =\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"LEO\"\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">  return\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> success\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"function-2-reversed\">Function 2 reversed\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#function-2-reversed\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h3>\n\u003Cp>This function is kinda of similar to the above function but checks if any file descriptor links to linjector. This is not important to Anti-Frida.\u003C/p>\n\u003Cpre class=\"astro-code catppuccin-mocha\" style=\"background-color:#1e1e2e;color:#cdd6f4; overflow-x: auto;\" tabindex=\"0\" data-language=\"cpp\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F9E2AF;font-style:italic\">__int64\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> sub_599EC\u003C/span>\u003Cspan style=\"color:#9399B2\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  ...omitted \u003C/span>\u003Cspan style=\"color:#CBA6F7\">for\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> brevity\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  v52 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#94E2D5\"> *\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#CDD6F4\">_QWORD \u003C/span>\u003Cspan style=\"color:#94E2D5\">*\u003C/span>\u003Cspan style=\"color:#9399B2\">)(\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">_ReadStatusReg\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">ARM64_SYSREG\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#FAB387\">3\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#FAB387\"> 3\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#FAB387\"> 13\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#FAB387\"> 0\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#FAB387\"> 2\u003C/span>\u003Cspan style=\"color:#9399B2\">))\u003C/span>\u003Cspan style=\"color:#94E2D5\"> +\u003C/span>\u003Cspan style=\"color:#FAB387\"> 40\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  v0 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> rotMinus2\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"/rtqe/ugnh/hf==\"\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003Cspan style=\"color:#9399B2;font-style:italic\"> // /proc/self/fd\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  v1 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> opendir\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#CDD6F4\">v0\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  v2 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> v1\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">  if\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#94E2D5\"> !\u003C/span>\u003Cspan style=\"color:#CDD6F4\">v1 \u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">  {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">    if\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> check_open\u003C/span>\u003Cspan style=\"color:#9399B2\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#94E2D5\">      ||\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#CDD6F4\">v27 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> rotMinus2\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"qrgpfkt==\"\u003C/span>\u003Cspan style=\"color:#9399B2\">),\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> checkForFunctionHook\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#CDD6F4\">v27\u003C/span>\u003Cspan style=\"color:#9399B2\">))\u003C/span>\u003Cspan style=\"color:#9399B2;font-style:italic\"> // opendir\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#94E2D5\">      ||\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#CDD6F4\">v28 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> rotMinus2\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"uvtuvt==\"\u003C/span>\u003Cspan style=\"color:#9399B2\">),\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> checkForFunctionHook\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#CDD6F4\">v28\u003C/span>\u003Cspan style=\"color:#9399B2\">))\u003C/span>\u003Cspan style=\"color:#9399B2\"> )\u003C/span>\u003Cspan style=\"color:#9399B2;font-style:italic\"> // strstr\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">    {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">      __android_log_print\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#FAB387\">4\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"AppProtectt\"\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"L-J..1.1\"\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">      v30 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"et\"\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">exitClause\u003C/span>\u003Cspan style=\"color:#9399B2\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">      callScanCore\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#CDD6F4\">v30\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">      parse_maps_and_change_permissions\u003C/span>\u003Cspan style=\"color:#9399B2\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">      exit\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#FAB387\">1\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">    goto\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> successClause\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">  v3 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> readdir\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#CDD6F4\">v1\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">  if\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> v3 \u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">  {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">    v4 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> v3\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">    v5 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#FAB387\"> 0\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">    while\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#FAB387\"> 1\u003C/span>\u003Cspan style=\"color:#9399B2\"> )\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">    {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">\t  ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#94E2D5\">      *\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#CDD6F4\">_OWORD \u003C/span>\u003Cspan style=\"color:#94E2D5\">*\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003Cspan style=\"color:#CDD6F4\">file \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#FAB387\"> 0\u003C/span>\u003Cspan style=\"color:#CBA6F7\">u\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">      v36 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#FAB387\"> 0\u003C/span>\u003Cspan style=\"color:#CBA6F7\">u\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">      v6 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> rotMinus2\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"/rtqe/ugnh/hf/%u==\"\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003Cspan style=\"color:#9399B2;font-style:italic\"> // /proc/self/fd/%s\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">      formatStr\u003C/span>\u003Cspan style=\"color:#9399B2\">((\u003C/span>\u003Cspan style=\"color:#CDD6F4\">__int64\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003Cspan style=\"color:#CDD6F4\">file\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#FAB387\"> 256\u003C/span>\u003Cspan style=\"color:#CBA6F7\">LL\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#FAB387\"> 256\u003C/span>\u003Cspan style=\"color:#CBA6F7\">LL\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> v6\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> v4\u003C/span>\u003Cspan style=\"color:#9399B2\">->\u003C/span>\u003Cspan style=\"color:#CDD6F4\">d_name\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">      lstat\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#CDD6F4\">file\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#CBA6F7\">struct\u003C/span>\u003Cspan style=\"color:#F9E2AF;font-style:italic\"> stat\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> *\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003Cspan style=\"color:#CDD6F4\">v31\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">      if\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#CDD6F4\">v32 \u003C/span>\u003Cspan style=\"color:#94E2D5\">&#x26;\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> 0x\u003C/span>\u003Cspan style=\"color:#FAB387\">F000\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003Cspan style=\"color:#94E2D5\"> ==\u003C/span>\u003Cspan style=\"color:#FAB387\"> 40960\u003C/span>\u003Cspan style=\"color:#9399B2\"> )\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">      {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">        v7 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> linux_eabi_syscall\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#CDD6F4\">__NR_readlinkat\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#94E2D5\"> -\u003C/span>\u003Cspan style=\"color:#FAB387\">100\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> file\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#CBA6F7\">char\u003C/span>\u003Cspan style=\"color:#94E2D5\"> *\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003Cspan style=\"color:#CDD6F4\">v51\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> 0x\u003C/span>\u003Cspan style=\"color:#FAB387\">100\u003C/span>\u003Cspan style=\"color:#CBA6F7\">u\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">        linjector \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> rotMinus2\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"nkplgevqt==\"\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003Cspan style=\"color:#9399B2;font-style:italic\"> // linjector\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">        if\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#CDD6F4\">v5 \u003C/span>\u003Cspan style=\"color:#94E2D5\">&#x26;\u003C/span>\u003Cspan style=\"color:#FAB387\"> 1\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003Cspan style=\"color:#94E2D5\"> ==\u003C/span>\u003Cspan style=\"color:#FAB387\"> 0\u003C/span>\u003Cspan style=\"color:#9399B2\"> )\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">        {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">          pid \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> getpid\u003C/span>\u003Cspan style=\"color:#9399B2\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">          formatStr\u003C/span>\u003Cspan style=\"color:#9399B2\">((\u003C/span>\u003Cspan style=\"color:#CDD6F4\">__int64\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003Cspan style=\"color:#94E2D5\">&#x26;\u003C/span>\u003Cspan style=\"color:#CDD6F4\">buf\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#FAB387\"> 32\u003C/span>\u003Cspan style=\"color:#CBA6F7\">LL\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#FAB387\"> 32\u003C/span>\u003Cspan style=\"color:#CBA6F7\">LL\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"%s%s%s%d%s\"\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"pr\"\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"oc\"\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"/\"\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> pid\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"/fd\"\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">exitClauseParent\u003C/span>\u003Cspan style=\"color:#9399B2\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">          FK\u003C/span>\u003Cspan style=\"color:#9399B2\">[\u003C/span>\u003Cspan style=\"color:#FAB387\">0\u003C/span>\u003Cspan style=\"color:#9399B2\">]\u003C/span>\u003Cspan style=\"color:#94E2D5\"> =\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"LFA\"\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">          __android_log_print\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#FAB387\">4\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"AppProtectt\"\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"L-J..1\"\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">          v30 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"lin\"\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">          goto\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> exitClause\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">      v4 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> readdir\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#CDD6F4\">v2\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">successClause\u003C/span>\u003Cspan style=\"color:#9399B2\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">    if\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> globalStatus \u003C/span>\u003Cspan style=\"color:#94E2D5\">==\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"not found\"\u003C/span>\u003Cspan style=\"color:#9399B2\"> )\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">      globalStatus \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"LEO\"\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">  return\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> closedir\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#CDD6F4\">v2\u003C/span>\u003Cspan style=\"color:#9399B2\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"bypassing-native-library-checks\">Bypassing native library checks\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#bypassing-native-library-checks\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h2>\n\u003Cp>When checking my phone, I was being detected because Frida creates a gmain thread. There are many ways to bypass this but I just hooked these two functions.\u003C/p>\n\u003Cp>The way I did that is by hooking  \u003Ccode>pthread_create\u003C/code> and after registering the startRoutine hook, I hook the two functions. I just add an offset from the base address because this is a temporary project. After the library is loaded I unhook \u003Ccode>pthread_create\u003C/code>.\u003C/p>\n\u003Cpre class=\"astro-code catppuccin-mocha\" style=\"background-color:#1e1e2e;color:#cdd6f4; overflow-x: auto;\" tabindex=\"0\" data-language=\"js\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">    let\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> threadHook \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> null\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">    const\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> pthread_create_ptr \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> Module\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">findExportByName\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#CBA6F7\">null\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"pthread_create\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">    console\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">log\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"[+] Found pthread_create at: \"\u003C/span>\u003Cspan style=\"color:#94E2D5\"> +\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> pthread_create_ptr)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">    System\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">loadLibrary\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">implementation\u003C/span>\u003Cspan style=\"color:#94E2D5\"> =\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> function\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#EBA0AC;font-style:italic\">library\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">        if\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> (library \u003C/span>\u003Cspan style=\"color:#94E2D5\">==\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"protectt-native-lib\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">) \u003C/span>\u003Cspan style=\"color:#9399B2\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">            threadHook \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> Interceptor\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">attach\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(pthread_create_ptr\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">                onEnter\u003C/span>\u003Cspan style=\"color:#94E2D5\">:\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> function\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#EBA0AC;font-style:italic\">args\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F38BA8\">                    this\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">threadPtr \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> args[\u003C/span>\u003Cspan style=\"color:#FAB387\">0\u003C/span>\u003Cspan style=\"color:#CDD6F4\">]\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F38BA8\">                    this\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">startRoutine \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> args[\u003C/span>\u003Cspan style=\"color:#FAB387\">2\u003C/span>\u003Cspan style=\"color:#CDD6F4\">]\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F38BA8\">                    this\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">routineArg \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> args[\u003C/span>\u003Cspan style=\"color:#FAB387\">3\u003C/span>\u003Cspan style=\"color:#CDD6F4\">]\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2;font-style:italic\">                    // Hooking first startRoutine after libprotectt is loaded is enough\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">                    if\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> (\u003C/span>\u003Cspan style=\"color:#94E2D5\">!\u003C/span>\u003Cspan style=\"color:#CDD6F4\">hooked) \u003C/span>\u003Cspan style=\"color:#9399B2\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">                        const\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> startRoutineHook \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> Interceptor\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">replace\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#F38BA8\">this\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">startRoutine\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#CBA6F7;font-weight:bold\"> new\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> NativeCallback\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#9399B2\">()\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> =>\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">                            console\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">log\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"[+] Thread function started\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">                            var\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> targetModule \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> Process\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">findModuleByName\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"libprotectt-native-lib.so\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">                            if\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> (targetModule) \u003C/span>\u003Cspan style=\"color:#9399B2\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">                                const\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> baseAddr \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> targetModule\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#CDD6F4\">base\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">                                Interceptor\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">replace\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(baseAddr\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">add\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#FAB387\">0x59E24\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#CBA6F7;font-weight:bold\"> new\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> NativeCallback\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#9399B2\">()\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> =>\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">                                    console\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">log\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"[+] mainThread Hook\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">                                },\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> 'void'\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> []))\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">                                Interceptor\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">replace\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(baseAddr\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">add\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#FAB387\">0x599EC\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#CBA6F7;font-weight:bold\"> new\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\"> NativeCallback\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#9399B2\">()\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> =>\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">                                    console\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">log\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"[+] mainThread2 Hook\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">                                },\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> 'void'\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> []))\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">                            }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">                        },\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> 'void'\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> [\u003C/span>\u003Cspan style=\"color:#A6E3A1\">'pointer'\u003C/span>\u003Cspan style=\"color:#CDD6F4\">]))\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">                        hooked \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#FAB387\"> true\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">                        threadHook\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">detach\u003C/span>\u003Cspan style=\"color:#CDD6F4\">()\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">                    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">                },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">            }\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">        Runtime\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">getRuntime\u003C/span>\u003Cspan style=\"color:#CDD6F4\">()\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">loadLibrary0\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(VMStack\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">getCallingClassLoader\u003C/span>\u003Cspan style=\"color:#CDD6F4\">()\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> library)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">        const\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> classLoader \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> VMStack\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">getCallingClassLoader\u003C/span>\u003Cspan style=\"color:#CDD6F4\">()\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">        if\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> (library \u003C/span>\u003Cspan style=\"color:#94E2D5\">==\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"protectt-native-lib\"\u003C/span>\u003Cspan style=\"color:#94E2D5\"> &#x26;&#x26;\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> threadHook) \u003C/span>\u003Cspan style=\"color:#9399B2\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">            threadHook\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">detach\u003C/span>\u003Cspan style=\"color:#CDD6F4\">()\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">            threadHook \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> null\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">    };\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"bypassing-root-detection\">Bypassing root detection\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#bypassing-root-detection\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h2>\n\u003Cp>With this I was able to bypass the Anti-Frida detection but now I was getting root detected.\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/reverse-engineering-icici-root-detection.png&#x22;,&#x22;alt&#x22;:&#x22;Root Detection&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Cp>So I tried searching for the string “Your Device is rooted. For security reasons…” in the APK but no results were found. I searched in \u003Ccode>/data/data\u003C/code> and \u003Ccode>/data/user\u003C/code> still no results.\u003C/p>\n\u003Cp>With no luck I tried searching for “Close App” again no luck. I tried with case insensitive and partial strings like “Your Device” etc… Still no luck.\u003C/p>\n\u003Cp>I decided to change my approach and search for Android APIs that exit the app, \u003Ca href=\"https://stackoverflow.com/questions/17719634/how-to-exit-an-android-app-programmatically\">Stackoverflow\u003C/a> has a good list.\u003C/p>\n\u003Cul>\n\u003Cli>finishAffinity\u003C/li>\n\u003Cli>finishAndRemoveTask\u003C/li>\n\u003Cli>getActivity().finish();\u003C/li>\n\u003Cli>System.exit(0)\u003C/li>\n\u003C/ul>\n\u003Cp>I tried searching for these with JADX code search and found a few interesting functions. It’s likely only the main one’s are relevant. And we focus our search inside the ai package.\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/reverse-engineering-icici-system-exit.png&#x22;,&#x22;alt&#x22;:&#x22;System.exit functions&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Cp>After seeing a few of these functions there is a common function \u003Ccode>companion.d()\u003C/code>. It’s called by everything that closes the apps. So instead of hooking all the above functions, we can just hook one and get the stacktrace.\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/reverse-engineering-icici-common.png&#x22;,&#x22;alt&#x22;:&#x22;Common code&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Cp>I hook this so I can see what exactly is calling it up the stack. So I can hook the parent function and bypass the root detection. This was by far the hardest part because there is at least 25 functions that need to be traced up the stack using Frida + JADX. I found several ways to bypass \u003Cdel>Censored\u003C/del> but I will be showing part of the process as the actual process is TOO long and I am not able to retrace what I did lol.\u003C/p>\n\u003Cpre class=\"astro-code catppuccin-mocha\" style=\"background-color:#1e1e2e;color:#cdd6f4; overflow-x: auto;\" tabindex=\"0\" data-language=\"js\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">let\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> a \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> Java\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">use\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"protecttor.app.security.main.g$a\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">a[\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"d\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">]\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">implementation\u003C/span>\u003Cspan style=\"color:#94E2D5\"> =\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> function\u003C/span>\u003Cspan style=\"color:#9399B2\"> ()\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">\tconsole\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">log\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">`a.d is called`\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">\tlet\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> result \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#F38BA8\"> this\u003C/span>\u003Cspan style=\"color:#CDD6F4\">[\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"d\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">]()\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">\tconsole\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">log\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">`a.d result=\u003C/span>\u003Cspan style=\"color:#9399B2\">${\u003C/span>\u003Cspan style=\"color:#CDD6F4\">result\u003C/span>\u003Cspan style=\"color:#9399B2\">}\u003C/span>\u003Cspan style=\"color:#A6E3A1\">`\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">\tconsole\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">log\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(Java\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">use\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"android.util.Log\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">getStackTraceString\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(Java\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">use\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"java.lang.Exception\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">$new\u003C/span>\u003Cspan style=\"color:#CDD6F4\">()))\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">\treturn\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> result\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">};\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Once we click “Close App” the last stack trace should give us the correct function.\u003C/p>\n\u003Cpre class=\"astro-code catppuccin-mocha\" style=\"background-color:#1e1e2e;color:#cdd6f4; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">a.d\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> is\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> called\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">a.d\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> result=[object\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> Object]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">java.lang.Exception\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">        at\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> protecttor.app.security.main.g\u003C/span>\u003Cspan style=\"color:#CDD6F4\">$a\u003C/span>\u003Cspan style=\"color:#A6E3A1\">.d\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">Native\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> Method\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">        at\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> protecttor.app.security.main.scan.ScanAlerts.x\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">Unknown\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> Source:49\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">        at\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> protecttor.app.security.main.scan.ScanAlerts.V\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">Unknown\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> Source:11\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">        at\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> protecttor.app.security.main.scan.ScanAlerts.d0\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">Unknown\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> Source:3\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">        at\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> protecttor.app.security.main.scan.ScanAlerts.f\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">Unknown\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> Source:0\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">        at\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> protecttor.app.security.main.scan.t.onClick\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">Unknown\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> Source:4\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">        at\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> android.view.View.performClick\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">View.java:8028\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">        at\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> android.view.View.performClickInternal\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">View.java:8005\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">        at\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> android.view.View.-\u003C/span>\u003Cspan style=\"color:#CDD6F4\">$$Nest$mperformClickInternal\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">Unknown\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> Source:0\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">        at\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> android.view.View\u003C/span>\u003Cspan style=\"color:#CDD6F4\">$PerformClick\u003C/span>\u003Cspan style=\"color:#A6E3A1\">.run\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">View.java:31233\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">        at\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> android.os.Handler.handleCallback\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">Handler.java:959\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">        at\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> android.os.Handler.dispatchMessage\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">Handler.java:100\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">        at\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> android.os.Looper.loopOnce\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">Looper.java:258\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">        at\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> android.os.Looper.loop\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">Looper.java:356\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">        at\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> android.app.ActivityThread.main\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">ActivityThread.java:8837\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">        at\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> java.lang.reflect.Method.invoke\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">Native\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> Method\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">        at\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> com.android.internal.os.RuntimeInit\u003C/span>\u003Cspan style=\"color:#CDD6F4\">$MethodAndArgsCaller\u003C/span>\u003Cspan style=\"color:#A6E3A1\">.run\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">RuntimeInit.java:598\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#89B4FA;font-style:italic\">        at\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> com.android.internal.os.ZygoteInit.main\u003C/span>\u003Cspan style=\"color:#9399B2\">(\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">ZygoteInit.java:896\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/reverse-engineering-icici-t-click.png&#x22;,&#x22;alt&#x22;:&#x22;&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Cpre class=\"astro-code catppuccin-mocha\" style=\"background-color:#1e1e2e;color:#cdd6f4; overflow-x: auto;\" tabindex=\"0\" data-language=\"plaintext\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan>ScanAlerts.U is called: btnBlock=androidx.appcompat.widget.AppCompatButton{6e89fa8 VFED..C.. ......I. 0,0-0,0 #7f0a03a7 app:id/btn_sdk_btn_block}, mBuilder=android.app.AlertDialog@5a\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>15ac1, btnIgnore=androidx.appcompat.widget.AppCompatButton{1a0a266 VFED..C.. ......I. 0,0-0,0 #7f0a03a8 app:id/btn_sdk_btn_ignore}, response=Java.Field{                              \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>        holder: protecttor.app.security.shouldnotobfuscated.dto.i@3c469a7,                \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>        fieldType: 2,                                                                                                                                                                 \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>        fieldReturnType: Ljava/lang/String;,                                                                                                                                          \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>        value: Your Device is rooted. For security reasons we have stopped the Mobile Banking Services on rooted devices.,                                                            \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>}, checkBoxForceAccept=androidx.appcompat.widget.AppCompatCheckBox{fc0e54 GFED..C.. ......I. 0,0-0,0 #7f0a0885 app:id/force_accept}                                                   \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>[+] Spoofing adb_enabled to 0 (OFF)                                                                                                                                                   \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>java.lang.Exception                                                                                                                                                                   \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>        at protecttor.app.security.main.scan.ScanAlerts.U(Native Method)                                                                                                             \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>        at protecttor.app.security.main.scan.ScanAlerts.C(Unknown Source:1084)                                                                                                       \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>        at protecttor.app.security.main.scan.ScanAlerts.a0(Unknown Source:289)                                                                                                       \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>        at protecttor.app.security.main.g.C1(Unknown Source:10)                                                                                                                      \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>        at protecttor.app.security.main.g.o(Unknown Source:0)                                                                                                                        \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>        at protecttor.app.security.main.c.run(Unknown Source:2)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>        at android.os.Handler.handleCallback(Handler.java:959\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/reverse-engineering-icici-b1.png&#x22;,&#x22;alt&#x22;:&#x22;&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Cp>Keep repeating this process and trying things, you should trace it to a call in \u003Ccode>IMOBILE\u003C/code> or \u003Ccode>IMobileApplication\u003C/code>. I will now move onto the findings.\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/reverse-engineering-icici-b1-parent.png&#x22;,&#x22;alt&#x22;:&#x22;&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Ch3 id=\"imobileoncreate\">IMOBILE.onCreate\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#imobileoncreate\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h3>\n\u003Cp>\u003Ccode>com.csam.xyzbank.bank.imobile.IMOBILE.onCreate\u003C/code> calls \u003Ccode>getLoggingStatus\u003C/code>. This function has nothing to do with logging but does security checks, \u003Cdel>Censored\u003C/del> is known to misdirect reverse researchers using fake naming, calling the actual function in an error exception, using decoy functions, among other techniques.\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/reverse-engineering-icici-oncreate.png&#x22;,&#x22;alt&#x22;:&#x22;&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Cp>\u003Ccode>getLoggingStatus\u003C/code> is a native function, we have to check all native libraries for this JNI function.\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/reverse-engineering-icici-get-logging-status.png&#x22;,&#x22;alt&#x22;:&#x22;&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Cp>The function was located in \u003Ccode>libnative-lib.so\u003C/code>, IDA shows it calls the function \u003Ccode>com.csam.xyzbank.bank.imobile.IMOBILE.logStatus()\u003C/code>.\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/reverse-engineering-icici-native-logging.png&#x22;,&#x22;alt&#x22;:&#x22;&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Cp>Here we finally see \u003Ccode>logStatus\u003C/code> calls \u003Ccode>log\u003C/code> and in turn calls some security checks.\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/reverse-engineering-icici-dsgf.png&#x22;,&#x22;alt&#x22;:&#x22;&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Ch3 id=\"imobileonresume\">IMOBILE.onResume\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#imobileonresume\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h3>\n\u003Cp>We just need to hook \u003Ccode>wVar.m(this, this);\u003C/code> and \u003Ccode>protecttor.app.security.common.helper.h0.f1361a.z(this, this)\u003C/code>.\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/reverse-engineering-icici-onresume-checks.png&#x22;,&#x22;alt&#x22;:&#x22;&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Ch3 id=\"root-bypass-script\">Root bypass script\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#root-bypass-script\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h3>\n\u003Cp>These are all the security checks called from the MainActivity, we want to block everything from the root so it doesn’t run in the background or start some \u003Ccode>Timer\u003C/code>. Finally putting all the bypasses together we get:\u003C/p>\n\u003Cpre class=\"astro-code catppuccin-mocha\" style=\"background-color:#1e1e2e;color:#cdd6f4; overflow-x: auto;\" tabindex=\"0\" data-language=\"js\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2;font-style:italic\">// Native library calls from IMOBILE.onCreate\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">let\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> IMOBILE \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> Java\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">use\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"com.csam.xyzbank.bank.imobile.IMOBILE\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">IMOBILE[\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"logStatus\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">]\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">implementation\u003C/span>\u003Cspan style=\"color:#94E2D5\"> =\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> function\u003C/span>\u003Cspan style=\"color:#9399B2\"> ()\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">\tconsole\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">log\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">`IMOBILE.logStatus is called`\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2;font-style:italic\">// ActivityLifecycleCallbacks\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">let\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> LoggerController \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> Java\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">use\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"protecttor.app.security.main.LoggerController\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">LoggerController[\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"i\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">]\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">implementation\u003C/span>\u003Cspan style=\"color:#94E2D5\"> =\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> function\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#EBA0AC;font-style:italic\">context\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#EBA0AC;font-style:italic\"> activity\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">\tconsole\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">log\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">`LoggerController.i is called: context=\u003C/span>\u003Cspan style=\"color:#9399B2\">${\u003C/span>\u003Cspan style=\"color:#CDD6F4\">context\u003C/span>\u003Cspan style=\"color:#9399B2\">}\u003C/span>\u003Cspan style=\"color:#A6E3A1\">, activity=\u003C/span>\u003Cspan style=\"color:#9399B2\">${\u003C/span>\u003Cspan style=\"color:#CDD6F4\">activity\u003C/span>\u003Cspan style=\"color:#9399B2\">}\u003C/span>\u003Cspan style=\"color:#A6E3A1\">`\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2;font-style:italic\">// IMOBILE.onResume Check1\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">let\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> h0 \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> Java\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">use\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"protecttor.app.security.common.helper.h0\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">h0[\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"z\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">]\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">implementation\u003C/span>\u003Cspan style=\"color:#94E2D5\"> =\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> function\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#EBA0AC;font-style:italic\">context\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#EBA0AC;font-style:italic\"> activity\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">console\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">log\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">`h0.z is called: context=\u003C/span>\u003Cspan style=\"color:#9399B2\">${\u003C/span>\u003Cspan style=\"color:#CDD6F4\">context\u003C/span>\u003Cspan style=\"color:#9399B2\">}\u003C/span>\u003Cspan style=\"color:#A6E3A1\">, activity=\u003C/span>\u003Cspan style=\"color:#9399B2\">${\u003C/span>\u003Cspan style=\"color:#CDD6F4\">activity\u003C/span>\u003Cspan style=\"color:#9399B2\">}\u003C/span>\u003Cspan style=\"color:#A6E3A1\">`\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2;font-style:italic\">// IMOBILE.onResume Check2\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">let\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> w \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> Java\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">use\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"protecttor.app.security.common.helper.w\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">w[\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"m\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">]\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">implementation\u003C/span>\u003Cspan style=\"color:#94E2D5\"> =\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> function\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#EBA0AC;font-style:italic\">context\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#EBA0AC;font-style:italic\"> activity\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">\tconsole\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">log\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">`w.m is called: context=\u003C/span>\u003Cspan style=\"color:#9399B2\">${\u003C/span>\u003Cspan style=\"color:#CDD6F4\">context\u003C/span>\u003Cspan style=\"color:#9399B2\">}\u003C/span>\u003Cspan style=\"color:#A6E3A1\">, activity=\u003C/span>\u003Cspan style=\"color:#9399B2\">${\u003C/span>\u003Cspan style=\"color:#CDD6F4\">activity\u003C/span>\u003Cspan style=\"color:#9399B2\">}\u003C/span>\u003Cspan style=\"color:#A6E3A1\">`\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">};\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"finally-getting-a-custom-vpa\">Finally getting a custom VPA\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#finally-getting-a-custom-vpa\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h2>\n\u003Cp>After launching my script with \u003Ca href=\"https://codeshare.frida.re/@akabe1/frida-multiple-unpinning/\">https://codeshare.frida.re/@akabe1/frida-multiple-unpinning/\u003C/a> I was able to view the HTTPS traffic. But unfortunately it was encrypted so we can’t just modify the request.\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/reverse-engineering-icici-zap.png&#x22;,&#x22;alt&#x22;:&#x22;&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Cp>Lets search for the string “encResponse” so we can print the strings as it’s being encrypted and decrypted. There were only 2 relevant results and one function is a wrapper for the below function so lets hook it. This condition calls \u003Ccode>w0\u003C/code> if the JSON has \u003Ccode>encResponse\u003C/code>.\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/reverse-engineering-icici-dsf.png&#x22;,&#x22;alt&#x22;:&#x22;&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Cp>w0 calls \u003Ccode>com.Discover.Security.a\u003C/code> etc. These are the functions we want to hook. We need to hook all the functions in these classes because which function is chosen is random.\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/reverse-engineering-icici-truirt.png&#x22;,&#x22;alt&#x22;:&#x22;&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Cp>This above screenshot is only for decryption, so the code I used to hook all encryption and decryption functions is:\u003C/p>\n\u003Cpre class=\"astro-code catppuccin-mocha\" style=\"background-color:#1e1e2e;color:#cdd6f4; overflow-x: auto;\" tabindex=\"0\" data-language=\"js\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">let\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> a \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> Java\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">use\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"com.Discover.Security.a\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">a[\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"a\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">]\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">implementation\u003C/span>\u003Cspan style=\"color:#94E2D5\"> =\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> function\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#EBA0AC;font-style:italic\">textToDecrypt\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">\tlet\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> result \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#F38BA8\"> this\u003C/span>\u003Cspan style=\"color:#CDD6F4\">[\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"a\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">](textToDecrypt)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">\tconsole\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">log\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">`a.a result=\u003C/span>\u003Cspan style=\"color:#9399B2\">${\u003C/span>\u003Cspan style=\"color:#CDD6F4\">result\u003C/span>\u003Cspan style=\"color:#9399B2\">}\u003C/span>\u003Cspan style=\"color:#A6E3A1\">`\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">\treturn\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> result\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">a[\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"b\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">]\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">implementation\u003C/span>\u003Cspan style=\"color:#94E2D5\"> =\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> function\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#EBA0AC;font-style:italic\">textToEncrypt\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">\tconsole\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">log\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">`a.b is called: textToEncrypt=\u003C/span>\u003Cspan style=\"color:#9399B2\">${\u003C/span>\u003Cspan style=\"color:#CDD6F4\">textToEncrypt\u003C/span>\u003Cspan style=\"color:#9399B2\">}\u003C/span>\u003Cspan style=\"color:#A6E3A1\">`\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">\tlet\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> result \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#F38BA8\"> this\u003C/span>\u003Cspan style=\"color:#CDD6F4\">[\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"b\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">](textToEncrypt)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">\tconsole\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">log\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">`a.b result=\u003C/span>\u003Cspan style=\"color:#9399B2\">${\u003C/span>\u003Cspan style=\"color:#CDD6F4\">result\u003C/span>\u003Cspan style=\"color:#9399B2\">}\u003C/span>\u003Cspan style=\"color:#A6E3A1\">`\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">\treturn\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> result\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">let\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> b \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> Java\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">use\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"com.Discover.Security.b\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">b[\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"a\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">]\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">implementation\u003C/span>\u003Cspan style=\"color:#94E2D5\"> =\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> function\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#EBA0AC;font-style:italic\">key\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#EBA0AC;font-style:italic\"> encryptedValue\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">\tlet\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> result \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#F38BA8\"> this\u003C/span>\u003Cspan style=\"color:#CDD6F4\">[\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"a\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">](key\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> encryptedValue)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">\tconsole\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">log\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"Response\"\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#FAB387\"> JSON\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">stringify\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#FAB387\">JSON\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">parse\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(result)\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> null\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#FAB387\"> 4\u003C/span>\u003Cspan style=\"color:#CDD6F4\">))\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">\treturn\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> result\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">b[\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"b\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">]\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">implementation\u003C/span>\u003Cspan style=\"color:#94E2D5\"> =\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> function\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#EBA0AC;font-style:italic\">key\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#EBA0AC;font-style:italic\"> value\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">\tconsole\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">log\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">`com.Discover.Security.b.b secureString \u003C/span>\u003Cspan style=\"color:#9399B2\">${\u003C/span>\u003Cspan style=\"color:#CDD6F4\">key\u003C/span>\u003Cspan style=\"color:#9399B2\">}\u003C/span>\u003Cspan style=\"color:#A6E3A1\">`\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">\tconst\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> json \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#FAB387\"> JSON\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">parse\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(value\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> null\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#FAB387\"> 4\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">\tconsole\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">log\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#FAB387\">JSON\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">stringify\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(json\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> null\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#FAB387\"> 4\u003C/span>\u003Cspan style=\"color:#CDD6F4\">))\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">\tlet\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> result \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#F38BA8\"> this\u003C/span>\u003Cspan style=\"color:#CDD6F4\">[\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"b\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">](key\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> value)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">\treturn\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> result\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">};\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Now that we can see the traffic, I wanted to check the JSON sent just before clicking create UPI ID. There is a VPA attribute which we can modify to our desired one. There are many ways to do this but I just hard coded the VPA in my Frida script. Unfortunately no screenshot for this. During my testing a UPI ID of at least 5 characters was required. All you need to do to get a custom UPI ID is modify the above code to this:\u003C/p>\n\u003Cpre class=\"astro-code catppuccin-mocha\" style=\"background-color:#1e1e2e;color:#cdd6f4; overflow-x: auto;\" tabindex=\"0\" data-language=\"js\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">b[\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"b\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">]\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">implementation\u003C/span>\u003Cspan style=\"color:#94E2D5\"> =\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> function\u003C/span>\u003Cspan style=\"color:#9399B2\"> (\u003C/span>\u003Cspan style=\"color:#EBA0AC;font-style:italic\">key\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#EBA0AC;font-style:italic\"> value\u003C/span>\u003Cspan style=\"color:#9399B2\">)\u003C/span>\u003Cspan style=\"color:#9399B2\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">\tconsole\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">log\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">`com.Discover.Security.b.b secureString \u003C/span>\u003Cspan style=\"color:#9399B2\">${\u003C/span>\u003Cspan style=\"color:#CDD6F4\">key\u003C/span>\u003Cspan style=\"color:#9399B2\">}\u003C/span>\u003Cspan style=\"color:#A6E3A1\">`\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">\tconst\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> json \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#FAB387\"> JSON\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">parse\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(value\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> null\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#FAB387\"> 4\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">\tif\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> (json\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#FAB387\">VPA\u003C/span>\u003Cspan style=\"color:#94E2D5\"> ===\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"upi_id_from_the_list\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">) \u003C/span>\u003Cspan style=\"color:#9399B2\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">\t\tjson\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#FAB387\">VPA\u003C/span>\u003Cspan style=\"color:#94E2D5\"> =\u003C/span>\u003Cspan style=\"color:#A6E3A1\"> \"YOUR_DESIRED_ID@bankxyz\"\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">\t\tconsole\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">log\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"CHANGED VPA\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">\t\tvalue \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#FAB387\"> JSON\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">stringify\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(json)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">\t}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CDD6F4\">\tconsole\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">log\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(\u003C/span>\u003Cspan style=\"color:#FAB387\">JSON\u003C/span>\u003Cspan style=\"color:#94E2D5\">.\u003C/span>\u003Cspan style=\"color:#89B4FA;font-style:italic\">stringify\u003C/span>\u003Cspan style=\"color:#CDD6F4\">(json\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#CBA6F7\"> null\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#FAB387\"> 4\u003C/span>\u003Cspan style=\"color:#CDD6F4\">))\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">\tlet\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> result \u003C/span>\u003Cspan style=\"color:#94E2D5\">=\u003C/span>\u003Cspan style=\"color:#F38BA8\"> this\u003C/span>\u003Cspan style=\"color:#CDD6F4\">[\u003C/span>\u003Cspan style=\"color:#A6E3A1\">\"b\"\u003C/span>\u003Cspan style=\"color:#CDD6F4\">](key\u003C/span>\u003Cspan style=\"color:#9399B2\">,\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> value)\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CBA6F7\">\treturn\u003C/span>\u003Cspan style=\"color:#CDD6F4\"> result\u003C/span>\u003Cspan style=\"color:#9399B2\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9399B2\">};\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>And voila!\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../images/customid.png&#x22;,&#x22;alt&#x22;:&#x22;&#x22;,&#x22;index&#x22;:0}\">\u003C/p>",{"headings":177,"localImagePaths":221,"remoteImagePaths":222,"frontmatter":223,"imagePaths":226},[178,179,182,185,188,191,194,197,200,203,206,209,212,215,218],{"depth":62,"slug":63,"text":64},{"depth":62,"slug":180,"text":181},"upi","UPI",{"depth":62,"slug":183,"text":184},"initial-analysis","Initial analysis",{"depth":62,"slug":186,"text":187},"attempting-to-locate-anti-frida-detection","Attempting to locate Anti-Frida detection",{"depth":62,"slug":189,"text":190},"protector-company","Protector Company",{"depth":62,"slug":192,"text":193},"extracting-native-libraries","Extracting native libraries",{"depth":62,"slug":195,"text":196},"reverse-engineering-android-native-libraries","Reverse engineering Android native libraries",{"depth":90,"slug":198,"text":199},"function-1-reversed","Function 1 reversed",{"depth":90,"slug":201,"text":202},"function-2-reversed","Function 2 reversed",{"depth":62,"slug":204,"text":205},"bypassing-native-library-checks","Bypassing native library checks",{"depth":62,"slug":207,"text":208},"bypassing-root-detection","Bypassing root detection",{"depth":90,"slug":210,"text":211},"imobileoncreate","IMOBILE.onCreate",{"depth":90,"slug":213,"text":214},"imobileonresume","IMOBILE.onResume",{"depth":90,"slug":216,"text":217},"root-bypass-script","Root bypass script",{"depth":62,"slug":219,"text":220},"finally-getting-a-custom-vpa","Finally getting a custom VPA",[150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172],[],{"title":139,"tags":224,"pubDate":225,"image":142,"description":140,"author":22,"isDraft":47},[144,145,146],"Apr 27 2025",[150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172],"reverse-engineering-a-banking-app.md","best-dotfiles-setup",{"id":228,"data":230,"body":234,"filePath":235,"digest":236,"rendered":237,"legacyId":248},{"title":231,"description":15,"pubDate":232,"image":17,"tags":233,"isDraft":21,"author":22},"Dotfiles Setup with Ansible and Chezmoi",["Date","2025-06-13T18:30:00.000Z"],[],"##","src/content/blog/best-dotfiles-setup.md","3fac9f91c7979436",{"html":238,"metadata":239},"\u003Ch2 id=\"\">\u003Ca class=\"autolink-header\" aria-hidden=\"\" tabindex=\"-1\" href=\"#\">\u003Cspan class=\"sr-only\"> permalink\u003C/span>\u003Csvg class=\"inline ml-2 hover:text-neutral-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\u003Cpath d=\"M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z\">\u003C/path>\u003C/svg>\u003C/a>\u003C/h2>",{"headings":240,"localImagePaths":243,"remoteImagePaths":244,"frontmatter":245,"imagePaths":247},[241],{"depth":62,"slug":242,"text":242},"",[],[],{"title":231,"tags":246,"pubDate":34,"image":17,"description":15,"author":22,"isDraft":21},[],[],"best-dotfiles-setup.md"]